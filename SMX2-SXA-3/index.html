
<!doctype html>
<html lang="ca" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Paco Galera & Javier Beteta">
      
      
        <link rel="canonical" href="https://pgalera.github.io/sxa/SMX2-SXA-3/">
      
      
        <link rel="prev" href="../SMX2-SXA-2/">
      
      
        <link rel="next" href="../SMX2-SXA-4/">
      
      
      <link rel="icon" href="../img/logojaume.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.33">
    
    
      
        <title>UD3. El servei DHCP - Serveis en Xarxa</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-GJ8MB56SLW"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-GJ8MB56SLW",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-GJ8MB56SLW",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script>
  

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="UD3. El servei DHCP - Serveis en Xarxa" >
      
        <meta  property="og:description"  content="None" >
      
        <meta  property="og:image"  content="https://pgalera.github.io/sxa/assets/images/social/SMX2-SXA-3.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://pgalera.github.io/sxa/SMX2-SXA-3/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="UD3. El servei DHCP - Serveis en Xarxa" >
      
        <meta  name="twitter:description"  content="None" >
      
        <meta  name="twitter:image"  content="https://pgalera.github.io/sxa/assets/images/social/SMX2-SXA-3.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ud3-el-servei-dhcp" class="md-skip">
          Salta el contingut
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="CapÃ§alera">
    <a href=".." title="Serveis en Xarxa" class="md-header__button md-logo" aria-label="Serveis en Xarxa" data-md-component="logo">
      
  <img src="../img/logojaume.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Serveis en Xarxa
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              UD3. El servei DHCP
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Mode oscur"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Mode oscur" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Mode clar"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Mode clar" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Cerca" placeholder="Cerca" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Cerca">
        
        <button type="reset" class="md-search__icon md-icon" title="Neteja" aria-label="Neteja" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicialitzant cerca
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="NavegaciÃ³" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Serveis en Xarxa" class="md-nav__button md-logo" aria-label="Serveis en Xarxa" data-md-component="logo">
      
  <img src="../img/logojaume.png" alt="logo">

    </a>
    Serveis en Xarxa
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ãndex
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SMX2-SXA-1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD1. InterconnexiÃ³ de xarxes
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SMX2-SXA-2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD2. AccÃ©s remot
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    UD3. El servei DHCP
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    UD3. El servei DHCP
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Taula de continguts">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Taula de continguts
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduccio" class="md-nav__link">
    <span class="md-ellipsis">
      IntroducciÃ³
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IntroducciÃ³">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evolucio-del-protocol-dhcp" class="md-nav__link">
    <span class="md-ellipsis">
      EvoluciÃ³ del protocol DHCP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#un-servei-clientservidor" class="md-nav__link">
    <span class="md-ellipsis">
      Un servei client/servidor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Un servei client/servidor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#el-client-dhcp" class="md-nav__link">
    <span class="md-ellipsis">
      El client DHCP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="El client DHCP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuracio-del-client" class="md-nav__link">
    <span class="md-ellipsis">
      ConfiguraciÃ³ del client
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#el-servidor-dhcp" class="md-nav__link">
    <span class="md-ellipsis">
      El servidor DHCP
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuracio-dun-equip-de-xarxa" class="md-nav__link">
    <span class="md-ellipsis">
      ConfiguraciÃ³ d'un equip de xarxa
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ConfiguraciÃ³ d'un equip de xarxa">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tipus-dassignacions-dadreces-ip" class="md-nav__link">
    <span class="md-ellipsis">
      Tipus d'assignacions d'adreces IP
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#el-model-funcional-dhcp" class="md-nav__link">
    <span class="md-ellipsis">
      El model funcional DHCP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="El model funcional DHCP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#udp-en-les-transmissions-dhcp" class="md-nav__link">
    <span class="md-ellipsis">
      UDP en les transmissions DHCP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UDP en les transmissions DHCP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dhcp-discover" class="md-nav__link">
    <span class="md-ellipsis">
      DHCP discover
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dhcp-offer" class="md-nav__link">
    <span class="md-ellipsis">
      DHCP offer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dhcp-request" class="md-nav__link">
    <span class="md-ellipsis">
      DHCP request
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dhcp-ack-dhcp-nack" class="md-nav__link">
    <span class="md-ellipsis">
      DHCP ack / DHCP nack
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dhcp-decline" class="md-nav__link">
    <span class="md-ellipsis">
      DHCP decline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dhcp-release" class="md-nav__link">
    <span class="md-ellipsis">
      DHCP release
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dhcp-information" class="md-nav__link">
    <span class="md-ellipsis">
      DHCP information
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#peticio-de-renovacioconcessio-duna-ip-concreta" class="md-nav__link">
    <span class="md-ellipsis">
      PeticiÃ³ de renovaciÃ³/concessiÃ³ d'una IP concreta
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#intervals-exclusions-concessions-i-reserves" class="md-nav__link">
    <span class="md-ellipsis">
      Intervals, exclusions, concessions i reserves
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#opcions-addicionals-del-protocol" class="md-nav__link">
    <span class="md-ellipsis">
      Opcions addicionals del protocol
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Opcions addicionals del protocol">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#option-subnet-mask" class="md-nav__link">
    <span class="md-ellipsis">
      option subnet-mask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#option-routers" class="md-nav__link">
    <span class="md-ellipsis">
      option routers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#option-domain-name-servers" class="md-nav__link">
    <span class="md-ellipsis">
      option domain-name-servers
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#problemes-del-servei" class="md-nav__link">
    <span class="md-ellipsis">
      Problemes del servei
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Problemes del servei">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#atacs-al-funcionament-de-dhcp-i-conflictes-dadreces-ip" class="md-nav__link">
    <span class="md-ellipsis">
      Atacs al funcionament de DHCP i conflictes d'adreces IP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conflictes-amb-les-adreces-ip" class="md-nav__link">
    <span class="md-ellipsis">
      Conflictes amb les adreces IP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diversos-servidors-dhcp-en-la-mateixa-xarxa" class="md-nav__link">
    <span class="md-ellipsis">
      Diversos servidors DHCP en la mateixa xarxa
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SMX2-SXA-4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD4. El servei DNS
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Manuals
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Manuals
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../manuals/CanviMirror/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Canvi de Mirror en Ubuntu
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../manuals/ManUbuntuServerDocker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker en Ubuntu Server
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../manuals/ManSolMachine_id/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DuplicaciÃ³ Machine-id
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Taula de continguts">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Taula de continguts
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduccio" class="md-nav__link">
    <span class="md-ellipsis">
      IntroducciÃ³
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IntroducciÃ³">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evolucio-del-protocol-dhcp" class="md-nav__link">
    <span class="md-ellipsis">
      EvoluciÃ³ del protocol DHCP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#un-servei-clientservidor" class="md-nav__link">
    <span class="md-ellipsis">
      Un servei client/servidor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Un servei client/servidor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#el-client-dhcp" class="md-nav__link">
    <span class="md-ellipsis">
      El client DHCP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="El client DHCP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuracio-del-client" class="md-nav__link">
    <span class="md-ellipsis">
      ConfiguraciÃ³ del client
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#el-servidor-dhcp" class="md-nav__link">
    <span class="md-ellipsis">
      El servidor DHCP
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuracio-dun-equip-de-xarxa" class="md-nav__link">
    <span class="md-ellipsis">
      ConfiguraciÃ³ d'un equip de xarxa
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ConfiguraciÃ³ d'un equip de xarxa">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tipus-dassignacions-dadreces-ip" class="md-nav__link">
    <span class="md-ellipsis">
      Tipus d'assignacions d'adreces IP
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#el-model-funcional-dhcp" class="md-nav__link">
    <span class="md-ellipsis">
      El model funcional DHCP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="El model funcional DHCP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#udp-en-les-transmissions-dhcp" class="md-nav__link">
    <span class="md-ellipsis">
      UDP en les transmissions DHCP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UDP en les transmissions DHCP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dhcp-discover" class="md-nav__link">
    <span class="md-ellipsis">
      DHCP discover
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dhcp-offer" class="md-nav__link">
    <span class="md-ellipsis">
      DHCP offer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dhcp-request" class="md-nav__link">
    <span class="md-ellipsis">
      DHCP request
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dhcp-ack-dhcp-nack" class="md-nav__link">
    <span class="md-ellipsis">
      DHCP ack / DHCP nack
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dhcp-decline" class="md-nav__link">
    <span class="md-ellipsis">
      DHCP decline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dhcp-release" class="md-nav__link">
    <span class="md-ellipsis">
      DHCP release
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dhcp-information" class="md-nav__link">
    <span class="md-ellipsis">
      DHCP information
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#peticio-de-renovacioconcessio-duna-ip-concreta" class="md-nav__link">
    <span class="md-ellipsis">
      PeticiÃ³ de renovaciÃ³/concessiÃ³ d'una IP concreta
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#intervals-exclusions-concessions-i-reserves" class="md-nav__link">
    <span class="md-ellipsis">
      Intervals, exclusions, concessions i reserves
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#opcions-addicionals-del-protocol" class="md-nav__link">
    <span class="md-ellipsis">
      Opcions addicionals del protocol
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Opcions addicionals del protocol">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#option-subnet-mask" class="md-nav__link">
    <span class="md-ellipsis">
      option subnet-mask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#option-routers" class="md-nav__link">
    <span class="md-ellipsis">
      option routers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#option-domain-name-servers" class="md-nav__link">
    <span class="md-ellipsis">
      option domain-name-servers
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#problemes-del-servei" class="md-nav__link">
    <span class="md-ellipsis">
      Problemes del servei
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Problemes del servei">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#atacs-al-funcionament-de-dhcp-i-conflictes-dadreces-ip" class="md-nav__link">
    <span class="md-ellipsis">
      Atacs al funcionament de DHCP i conflictes d'adreces IP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conflictes-amb-les-adreces-ip" class="md-nav__link">
    <span class="md-ellipsis">
      Conflictes amb les adreces IP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diversos-servidors-dhcp-en-la-mateixa-xarxa" class="md-nav__link">
    <span class="md-ellipsis">
      Diversos servidors DHCP en la mateixa xarxa
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="ud3-el-servei-dhcp">UD3. El servei DHCP</h1>
<h2 id="introduccio">IntroducciÃ³</h2>
<p>Lâadministrador de xarxa tÃ© la tasca de configurar els equips que la componen. AixÃ² significa configurar els servidors, els equips client, concentradors, encaminadors, etc. Cada equip de la xarxa sâha dâidentificar amb lâadreÃ§a IP corresponent i la mÃ scara de xarxa, i generalment disposarÃ  dâun camÃ­ dâaccÃ©s a Internet.</p>
<p>Tant els usuaris com els serveis requeriran lâaccÃ©s a altres equips identificant-los pel nom de domini en lloc de fer-ho per lâadreÃ§a IP, que Ã©s mÃ©s difÃ­cil de recordar. Fer aixÃ² equip per equip resulta una feina pesada i repetitiva si no es disposa de serveis de xarxa que la faciliten.</p>
<p>El servei DHCP permet la configuraciÃ³ dâadreces IP, mÃ scares, passarelÂ·les per defecte i moltes altres opcions de configuraciÃ³ de manera totalment dinÃ mica. DHCP Ã©s lâacrÃ²nim de dynamic host configuration protocol, en catalÃ , protocol de configuraciÃ³ dinÃ mica dâequips.</p>
<div class="admonition note">
<p class="admonition-title">QuÃ¨ fa el DHCP?</p>
<p>Una forma planera dâentendre el DHCP Ã©s imaginar que els equips de client en arrencar fan un crit per la xarxa i pregunten <strong><em>hi ha algÃº?</em></strong>, <strong><em>qui sÃ³c jo?</em></strong>. El servidor de DHCP els contesta proporcionant-los tota la informaciÃ³ necessÃ ria perquÃ¨ sÃ piguen qui sÃ³n i com han de configurar els seus parÃ metres de xarxa.</p>
</div>
<p>El servei DHCP proporciona un mecanisme de configuraciÃ³ centralitzat dels equips de la xarxa. En lloc de configurar un per un els equips de xarxa amb adreces i valors estÃ tics, un servidor DHCP anirÃ  assignant als equips clients els valors que els corresponguin. Aquesta assignaciÃ³ es fa per un perÃ­ode de temps finit, passat el qual caldrÃ  renovar-se.</p>
<p>Els principals avantatges dâutilitzar DHCP sÃ³n: dâuna banda, <strong>evitar conflictes</strong> dâadreces IP (adreces repetides i adreces errÃ²nies), ja que passar equip per equip a canviar la configuraciÃ³ Ã©s molt mÃ©s pesat i propens a lâerror que fer-ho editant un sol fitxer de configuraciÃ³ en el servidor DHCP; i, dâaltra banda, poder fer lâ<strong>administraciÃ³ centralitzada</strong> representa un estalvi de temps i de feina.</p>
<p>El servei DHCP <strong>simplifica lâadministraciÃ³</strong> de la configuraciÃ³ dels equips de xarxa fent-la centralitzada, dinÃ mica i amb concessions per perÃ­odes de temps finits.</p>
<p>La concessiÃ³ dinÃ mica dâadreces IP i altres parÃ metres de configuraciÃ³ de xarxa es realitza per a un perÃ­ode de temps determinat, que varia en funciÃ³ de les necessitats del client i del servidor.</p>
<div class="admonition note">
<p class="admonition-title">Avantatges DHCP</p>
<p>El servei DHCP tÃ© diversos avantatges:</p>
<ul>
<li>Centralitza l'administraciÃ³</li>
<li>Evita errors i conflictes IP</li>
<li>Estalvia temps</li>
<li>Simplifica l'administraciÃ³</li>
</ul>
</div>
<div class="admonition example">
<p class="admonition-title">Exemples d'Ãºs del servei DHCP</p>
<ul>
<li>En una biblioteca que admet connexions Wi-Fi, els clients obtindran concessions per a un temps reduÃ¯t, per exemple, minuts.</li>
<li>Un usuari dâInternet que rep al seu equip de casa una adreÃ§a IP dinÃ mica del seu proveÃ¯dor dâaccÃ©s a Internet (ISP) tindrÃ  una concessiÃ³ que segurament serÃ  per hores.</li>
<li>En la xarxa corporativa dâuna empresa que sâha configurat dinÃ micament usant DHCP, els equips rebran concessions dinÃ miques per perÃ­odes de temps molt llargs, per exemple, dies.</li>
</ul>
</div>
<h3 id="evolucio-del-protocol-dhcp">EvoluciÃ³ del protocol DHCP</h3>
<p>El protocol DHCP ve descrit, com la majoria de protocols de xarxa, per un document oficial anomenat <strong>RFC</strong>. Al llarg dels anys ha sofert diverses evolucions per anar-se adaptant a les necessitats de cada moment. Tot protocol implica un diÃ leg entre els equips que hi intervenen, ens caldrÃ  doncs analitzar quin Ã©s i com es produeix aquest diÃ leg.</p>
<details class="info">
<summary>EvoluciÃ³ del protocol DHCP</summary>
<p>El servei DHCP Ã©s un servei del tipus client-servidor que proporciona la configuraciÃ³ de xarxa als clients que ho solÂ·liciten. Proporciona els parÃ metres bÃ sics de xarxa com lâadreÃ§a IP, la mÃ scara de xarxa, la porta dâenllaÃ§ i tambÃ© dâaltres parÃ metres necessaris per a una connexiÃ³ en una xarxa IP. Es tracta dâun protocol de la capa dâaplicaciÃ³ del model TCP/IP.</p>
<p>El protocol DHCP estÃ  basat en lâarquitectura de serveis client-servidor i utilitza com a transport el protocol UDP de la pila de protocols TCP/ IP. El servidor DHCP es comunica amb els clients utilitzant paquets UDP, que rep en el seu port 67 i envia al port 68 del client.</p>
<p>La configuraciÃ³ dinÃ mica dâequips de xarxa es va iniciar amb el protocol BOOTP (BOOT strap protocol, protocol dâarrencada). Un protocol mÃ©s bÃ sic que principalment permetia definir lâadreÃ§a IP, la mÃ scara de xarxa i la passarelÂ·la per defecte per al client. El protocol BOOTP (RFC 951, any 1985) Ã©s un protocol pensat per proporcionar automÃ ticament la IP a clients de xarxa en el procÃ©s dâarrencada. OriginÃ riament sâutilitzava per a estacions de treball sense disc que obtenien la configuraciÃ³ de xarxa del protocol BOOTP i tambÃ© obtenien el nom dâun fitxer dâarrencada que sâhavia de baixar per mitjÃ  del TFTP, que usualment era el sistema operatiu.</p>
<p>El BOOTP va donar pas al protocol DHCP, que nâÃ©s una evoluciÃ³ amb moltes mÃ©s prestacions. El DHCP sorgeix lâoctubre del 1993 a travÃ©s de lâRFC 1531. RÃ pidament evoluciona per mitjÃ  de diverses RFC, com lâRFC 1541 el mateix any 1993, que serÃ  substituÃ¯da per lâRFC 2131 el marÃ§ del 1997. Aquest document Ã©s la base del protocol DHCP actual. A grans trets, el protocol es descriu en lâRFC 2131 per a xarxes Ipv4, el conjunt dâopcions de configuraciÃ³ de DHCP es descriuen en lâRFC 2132, i lâespecificaciÃ³ de DHCP per a xarxes Ipv6 Ã©s en lâRFC 3315.</p>
<p><strong>PRINCIPALS RFC DEDICADES A DHCP:</strong></p>
<ul>
<li>RFC 2131. MarÃ§ 1997. DHCP dynamic host configuration protocol.</li>
<li>RFC 2132. DHCP options.</li>
<li>RFC 3396. Encoding long options.</li>
<li>RFC 4361. No especific client identifications for dhcpv4.</li>
<li>RFC 3315. DHCPv6 dinamic host configuration protocol Ipv6.</li>
</ul>
<p>Els Request for Comments (RFC) sÃ³n memorÃ ndums sobre noves investigacions, innovacions i metodologies relacionades amb les tecnologies dâInternet. Quan els publica lâIETF (Internet Engineering Task Force) defineixen a escala mundial els protocols i les seves revisions. Ãs a dir, sÃ³n les publicacions oficials que descriuen els protocols.</p>
</details>
<h3 id="un-servei-clientservidor">Un servei client/servidor</h3>
<p>Com acostuma a passar amb els serveis client/servidor, un equip pot realitzar les dues funcions al mateix temps.</p>
<p>El servei DHCP Ã©s un mÃ©s dels serveis de xarxa que tenen lâestructura client /servidor. Els servidors DHCP sÃ³n els equips que tenen en execuciÃ³ el programa servidor. Ãs el programa encarregat dâatendre les peticions dels clients i oferir-los la configuraciÃ³ de xarxa, <strong>tot portant el registre de les IP que concedeix i el registre de totes les accions que realitza</strong>. Els clients DHCP sÃ³n aquells equips que realitzen peticions per obtenir una configuraciÃ³ de xarxa a un servidor DHCP.</p>
<h4 id="el-client-dhcp">El client DHCP</h4>
<p>Un equip client DHCP Ã©s un equip que solÂ·licita la IP i altres parÃ metres de configuraciÃ³ de xarxa a un servidor DHCP en lloc de tenir-los definits localment en lâequip.</p>
<div class="admonition note">
<p class="admonition-title">ISP</p>
<p><strong>ISP</strong>: <em>Internet service provider</em> o proveÃ¯dor de servei/accÃ©s a Internet. Ho sÃ³n per exemple les empreses Movistar, Vodafone, Jazztel, etc.</p>
</div>
<p>Si connecteu el vostre equip informÃ tic a la xarxa Internet per mitjÃ  dâun ISP, segurament rebreu una IP dinÃ mica del vostre proveÃ¯dor. Quan es realitzava una trucada telefÃ²nica amb mÃ²dem i usant el protocol PPP (<em>point to point protocol</em>, protocol punt a punt), el proveÃ¯dor proporcionava una adreÃ§a IP dinÃ mica. Si utilitzeu ADSL i un encaminador o router, segurament lâencaminador us proporciona una adreÃ§a IP dinÃ mica privada a lâordinador de casa. Al mateix temps, lâencaminador obtÃ© una IP dinÃ mica pÃºblica del proveÃ¯dor. Aquestes adreces IP dinÃ miques sÃ³n fixes (sempre les mateixes) o dinÃ miques dâinterval (pot ser qualsevol IP del conjunt dâadreces IP que tÃ© disponibles per concedir el servidor DHCP).</p>
<div class="admonition note">
<p class="admonition-title">IP pÃºblica / IP privada</p>
<p>La diferÃ¨ncia entre una IP pÃºblica i una IP privada Ã©s que la pÃºblica Ã©s visible per a tots els equips dâInternet, mentre que la privada Ã©s visible nomÃ©s dins de la mateixa xarxa local.</p>
</div>
<p>El client DHCP ha de tenir en funcionament un dimoni (<em>daemon</em>) encarregat de la gestiÃ³ de les tasques DHCP per part del client. El programa client realitza la part de negociaciÃ³ encarregada al client (<em>DHCP discovery, request</em>) i tambÃ© porta un registre de les concessions (<em>leases</em>) rebudes. Aquest registre Ã©s el que utilitza el client per tornar a demanar la mateixa IP que tenia anteriorment. Un cop rebuda la concessiÃ³ el programa client queda âadormitâ, pendent de tornar-se a executar automÃ ticament quan calgui renegociar la concessiÃ³. Sense intervenciÃ³ de lâusuari, el programa client sâactiva i segueix el procediment necessari per renegociar lâadreÃ§a IP cada cop que el temps de la concessiÃ³ s'esgota.</p>
<h5 id="configuracio-del-client">ConfiguraciÃ³ del client</h5>
<p>Usualment les configuracions clients es poden fer de tres maneres diferents:</p>
<ul>
<li>fitxer de text: editar directament els fitxers de configuraciÃ³.</li>
<li>menÃºs en mode text: usant algun programa de menÃºs amb interfÃ­cie de text.</li>
<li>aplicaciÃ³ grÃ fica: usant una aplicaciÃ³ de finestres en lâentorn grÃ fic.</li>
</ul>
<p>Els programes client varien dâun sistema operatiu a un altre i la manera dâexecutar-los tambÃ©. Generalment es disposa dâun client executable en mode text o ordres i dâuna interfÃ­cie grÃ fica (GUI, <em>graphics user interface</em> o interfÃ­cie grÃ fica dâusuari) per a la configuraciÃ³. No cal dir que els sistemes Windows tendeixen a la configuraciÃ³ grÃ fica usant finestres i a la configuraciÃ³ i execuciÃ³ interna dâamagat de lâusuari. Normalment, en els sistemes GNU/Linux, la configuraciÃ³ es fa usant fitxers de text o com a opcions en lâordre dâexecuciÃ³. La interfÃ­cie grÃ fica acostuma a ser un frontal (<em>front-end</em>) per cridar lâordre. Segons sigui el sistema operatiu es pot consultar el fitxer de registre de les concessions rebudes pel client, el fitxer de <em>leases</em>, mÃ©s o menys detalladament.</p>
<p>Generalment el programa client es pot configurar per definir-ne el comportament en la comunicaciÃ³ amb el servidor: informaciÃ³ a demanar, informaciÃ³ a proporcionar al servidor, opcions per defecte, etc.</p>
<h4 id="el-servidor-dhcp">El servidor DHCP</h4>
<p>L'administrador de xarxa Ã©s l'encarregat de pensar la ubicaciÃ³ del servidor o servidors DHCP en l'estructura corporativa. Com mÃ©s complicada sigui la topologia de la xarxa, mÃ©s difÃ­cil en serÃ  la gestiÃ³. Una xarxa corporativa bÃ sica pot disposar d'un Ãºnic servidor DHCP que ofereix els seus serveis a tots els equips de la xarxa. Els clients poden estar en una mateixa subxarxa o en diverses subxarxes, perÃ² totes amb connectivitat amb el servidor DHCP. Aquest tambÃ© pot ser l'esquema d'una xarxa privada a casa, on un router (el de lâISP, per exemple) proporciona el servei DHCP a tots els ordinadors de la casa.</p>
<p>Si la xarxa corporativa creix i passa a tenir subxarxes segmentades amb tallafocs les unes de les altres, la configuraciÃ³ del servidor DHCP es complica. Si es vol continuar amb un Ãºnic servidor per a tota la xarxa, caldrÃ  que els tallafocs (<em>firewalls</em>) deixin passar els paquets DHCP entre les subxarxes i el servidor. Una altra opciÃ³ Ã©s posar un servidor DHCP per a cada subxarxa o grups de subxarxes. Fent-ho aixÃ­, lâadministraciÃ³ de cada servidor Ã©s mÃ©s senzilla perÃ² hi ha mÃ©s servidors a administrar. Una xarxa amb una casuÃ­stica completa Ã©s la que tÃ© diversos servidors DHCP per a diverses parts de la xarxa i tallafocs entre clients i servidors que han de permetre el pas de paquets DHCP.</p>
<p>Si el servidor DHCP Ã©s lâencarregat de donar adreces IP als clients, qui li proporciona una adreÃ§a IP a ell? O bÃ© un altre servidor DHCP (i podrÃ­em tornar a fer la mateixa pregunta indefinidament) o bÃ© lâadministrador. <strong>Usualment, en una xarxa corporativa el servidor DHCP utilitza una IP estÃ tica definida per lâadministrador</strong>. AixÃ² li permet estar sempre disponible per als clients amb la mateixa IP i no el fa dependre dâun altre servidor extern.</p>
<p>Hi ha diversos programes servidors DHCP: en mode text, en mode grÃ fic, en mode âmÃ gicâ (no es veu quÃ¨ fan) i en mode Unix (tot basat en fitxers de text). Cada administrador treballa amb les seves eines preferides. Les tasques bÃ siques per aprendre a utilitzar un servidor DHCP sÃ³n:
- Observar/fer una llista de la configuraciÃ³ actual.
- Activar/aturar el servei.
- Modificar la configuraciÃ³.
- Monitorar els logs (registre de successos del servei).
- Saber instalÂ·lar i desinstalÂ·lar lâaplicaciÃ³ servidor.</p>
<p>Els fitxers de logs (successos) recullen els esdeveniments que es volen monitorar.</p>
<p>Com la majoria de serveis de xarxa, el servei DHCP Ã©s un servei que sâexecuta en segon pla en forma de dimoni. El servidor DHCP sempre estÃ  engegat escoltant en el <strong>port 67</strong> les peticions que rep dels clients. Quan rep una peticiÃ³ entrant, el programa executable del servidor DHCP la processa i posa en marxa tot el mecanisme DHCP pertinent per tornar a escoltar noves peticions. De fet, el servidor sempre escolta peticions i les processa simultÃ niament (segons la configuraciÃ³).</p>
<p>Els fitxers del registre del servei, on sâanoten les concessions, permeten mantenir la informaciÃ³ encara que el servei sâaturi o que el servidor sâapagui. En tornar a engegar es llegiran de nou els fitxers de registres per tal de saber quines sÃ³n les concessions que sâhavien realitzat.</p>
<p>Els fitxers de concessions permeten mantenir la coherÃ¨ncia de lâassignaciÃ³ dâadreces IP entre aturades del servei.</p>
<h2 id="configuracio-dun-equip-de-xarxa">ConfiguraciÃ³ d'un equip de xarxa</h2>
<p>Qualsevol equip que pertany a una xarxa requereix que es configure amb uns parÃ metres mÃ­nims, que sÃ³n lâ<strong>adreÃ§a IP</strong>, la <strong>mÃ scara</strong> i la <strong>porta dâenllaÃ§</strong> per defecte. LâadreÃ§a IP identifica lâequip de manera Ãºnica, i la mÃ scara permet determinar la xarxa o subxarxa en quÃ¨ es troba lâequip. Amb aquests dos parÃ metres nâhi ha prou per tenir connectivitat en la xarxa. Si es vol disposar dâaccÃ©s fora de la xarxa prÃ²pia (per exemple, a Internet o a la resta de la xarxa corporativa) cal definir tambÃ© la porta dâenllaÃ§ predeterminada. A part de la configuraciÃ³ bÃ sica, els equips poden necessitar (i de fet ho necessiten) mÃ©s parÃ metres de configuraciÃ³ com, per exemple: el <strong>nom del host</strong>, el <strong>servidor DNS</strong>, el fitxer dâiniciaciÃ³ a baixar, etc.</p>
<details class="example">
<summary>Exemple de configuraciÃ³ de xarxa d'un equip de casa</summary>
<p>La majoria dâusuaris disposen a casa dâun equip (o mÃ©s) connectats a un router que proporciona lâaccÃ©s a Internet. Aquest equip estÃ  configurat com a client DHCP i en iniciar-se rep la configuraciÃ³ de xarxa del router. Podeu comprovar a casa quina configuraciÃ³ teniu. Una configuraciÃ³ dâexemple podria ser:</p>
<p><center></p>
<table>
<thead>
<tr>
<th style="text-align: center;"><strong>ParÃ metre</strong></th>
<th style="text-align: center;">Valor</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><strong>AdreÃ§a IP</strong></td>
<td style="text-align: center;">192.168.1.33</td>
</tr>
<tr>
<td style="text-align: center;"><strong>MÃ scara de subxarxa</strong></td>
<td style="text-align: center;">255.255.255.0</td>
</tr>
<tr>
<td style="text-align: center;"><strong>Porta d'enllaÃ§</strong></td>
<td style="text-align: center;">192.168.1.1</td>
</tr>
<tr>
<td style="text-align: center;"><strong>Servidor DHCP</strong></td>
<td style="text-align: center;">192.168.1.1</td>
</tr>
<tr>
<td style="text-align: center;"><strong>Servidors DNS</strong></td>
<td style="text-align: center;">8.8.8.8 - 8.8.4.4</td>
</tr>
</tbody>
</table>
<p></center></p>
</details>
<p><strong>Inconvenient de la configuraciÃ³ estÃ tica</strong></p>
<p>La configuraciÃ³ estÃ tica implica configurar els equips un a un. Fins i tot encara que es tinga accÃ©s remot als equips (per Telnet o SSH), com que cal modificar la configuraciÃ³ de xarxa no es pot fer assegut des de lâequip de lâadministrador, sinÃ³ que cal anar equip per equip a modificar la configuraciÃ³.</p>
<p>Aquest procÃ©s de configuraciÃ³ cal que es faci per a cada equip de la xarxa. Fer-lo manualment implica configurar equip per equip sense cometre errades en teclejar les adreces i les mÃ scares. Qualsevol canvi en lâestructura de la xarxa, com per exemple redefinir les subxarxes o modificar algunes adreces IP, significa tornar a configurar manualment els equips implicats. Ãs evident que tota aquesta feinada no Ã©s agradable per a lâadministrador de xarxa (i Ã©s molt avorrida!). Tant si la xarxa corporativa consta de pocs equips com de molts, cal una soluciÃ³ que permeti automatitzar la configuraciÃ³ de xarxa de cada equip de manera centralitzada.</p>
<p>Les opcions de configuraciÃ³ de xarxa es poden assignar a cada equip estÃ ticament o es poden configurar de manera dinÃ mica utilitzant DHCP.</p>
<p>Com a administradors de xarxa, la gestiÃ³ centralitzada que ens proporciona DHCP ens permet modificar la xarxa afegint, eliminant i redefinint, equips amb un cost mÃ­nim.</p>
<h3 id="tipus-dassignacions-dadreces-ip">Tipus d'assignacions d'adreces IP</h3>
<p>Cada equip de xarxa tÃ© assignada una adreÃ§a IP que lâidentifica de manera Ãºnica dins la xarxa. La composiciÃ³ de lâadreÃ§a IP i la mÃ scara determina la xarxa o subxarxa a la qual pertany. A mÃ©s a mÃ©s, es configuren altres parÃ metres de xarxa com la porta dâenllaÃ§ predeterminada, servidors DNS, etc. AixÃ² es pot configurar manualment anant equip per equip i introduint aquesta informaciÃ³.</p>
<p>Quan lâadreÃ§a IP i els altres parÃ metres necessaris de configuraciÃ³ de la xarxa es configuren equip per equip, manualment, es diu que tenen una <strong>configuraciÃ³ IP estÃ tica</strong>.</p>
<p>Quan la configuraciÃ³ de xarxa d'un equip no es fa manualment i localment en lâequip sinÃ³ que es rep per mitjÃ  dâun servidor DHCP, es diu que lâequip utilitza una <strong>configuraciÃ³ IP dinÃ mica</strong>. Per realitzar configuracions de xarxa dinÃ micament caldran un o mÃ©s servidors de DHCP (a manera de redundÃ ncia) que proporcionaran la configuraciÃ³ als equips clients (els que cal configurar). Per tant, serÃ  una estructura client-servidor. Les adreces IP dinÃ miques que rep el client les podem classificar en dues categories: assignaciÃ³ dinÃ mica d'interval i assignaciÃ³ fixa.</p>
<p>El servidor DHCP disposa dâun interval dâadreces que pot assignar als clients que demanen una adreÃ§a IP. Quan el servidor assigna una adreÃ§a qualsevol de lâinterval al client (a lâatzar) es tracta dâuna assignaciÃ³ dinÃ mica dâinterval. El client no sap quina adreÃ§a IP tindrÃ  i no hi ha manera de predir quina adreÃ§a se li concedirÃ  en una futura configuraciÃ³. A cada nova assignaciÃ³ lâadreÃ§a IP pot ser diferent.</p>
<p>Una assignaciÃ³ fixa es produeix quan el servidor DHCP sempre assigna la mateixa adreÃ§a al client. Per assignar sempre la mateixa adreÃ§a IP al client cal que el servidor pugui identificar inequÃ­vocament el client (per lâadreÃ§a MAC). El servidor disposa dâuna taula amb les correspondÃ¨ncies entre les adreces MAC i les adreces IP fixes.</p>
<p>Quan la configuraciÃ³ de xarxa dâun equip es rep per mitjÃ  dâun servidor DHCP es diu que utilitza una <strong>adreÃ§a IP dinÃ mica</strong>. Aquesta adreÃ§a pot variar dins dâun interval dâadreces disponibles per al servidor DHCP o pot ser fixa. Si l'assignaciÃ³ de la configuraciÃ³ es fa per a sempre es diu que es fa una assignaciÃ³ de <strong>configuraciÃ³ IP automÃ tica</strong>.</p>
<p>Els avantatges de disposar dâuna IP fixa sÃ³n que la vostra identificaciÃ³ a Internet (la vostra adreÃ§a IP) no varia i tothom us pot identificar sempre per la mateixa IP. Podeu proporcionar serveis a altres equips, els clients us identifiquen sempre amb la mateixa adreÃ§a sense haver de recordar en cada moment quina adreÃ§a IP teniu avui (com passa en el cas dâuna IP dinÃ mica).</p>
<div class="admonition note">
<p class="admonition-title">MAC</p>
<p><strong>MAC</strong>: Cada interfÃ­cie de xarxa sâidentifica de manera Ãºnica fÃ­sicament per lâadreÃ§a MAC (<em>media acces control</em>, adreÃ§a dâaccÃ©s al medi).</p>
</div>
<h2 id="el-model-funcional-dhcp">El model funcional DHCP</h2>
<p>El protocol DHCP utilitza UDP en la capa de transport. Utilitza dos ports:</p>
<ul>
<li><strong>Port 67</strong>: on escolta el servidor</li>
<li><strong>Port 68</strong>: on escolta el client</li>
</ul>
<p>El protocol DHCP descriu el diÃ leg que es produeix entre client i servidor per a la concessiÃ³ de configuracions IP. En una xarxa amb configuraciÃ³ dâequips dinÃ mica, un o mÃ©s servidors DHCP escoltaran les peticions dels clients en el port 67. Els clients DHCP solÂ·licitaran al servidor DHCP una configuraciÃ³ IP, i comenÃ§arÃ  un procÃ©s de negociaciÃ³ que ha dâacabar (si tot va bÃ©) amb la concessiÃ³ dâuna adreÃ§a IP al client. Els servidors parlen al port 68 dels clients.</p>
<p>La negociaciÃ³ que sâestableix es pot definir a grans trets de la manera segÃ¼ent:</p>
<ol>
<li>El client solÂ·licita una adreÃ§a IP (de fet, una configuraciÃ³ de xarxa).</li>
<li>El servidor mira les adreces IP disponibles dins de lâinterval dâadreces dinÃ miques de quÃ¨ disposa per concedir i nâofereix una al client.</li>
<li>Si el client lâaccepta, envia una solÂ·licitud al servidor per fer-la seva.</li>
<li>Si al servidor li sembla bÃ©, accepta la peticiÃ³ del client i li confirma que pot utilitzar aquesta IP, que la hi concedeix per un perÃ­ode de temps limitat.</li>
</ol>
<h3 id="udp-en-les-transmissions-dhcp">UDP en les transmissions DHCP</h3>
<p>Lâintercanvi dâinformaciÃ³ entre client i servidor no Ã©s massa gran (poc volum de dades) i no requereix un flux permanent (una conversa continuada). Ãs per aixÃ² que el protocol que sâutilitza en les transmissions DHCP Ã©s lâUDP.</p>
<p>La concessiÃ³ de lâadreÃ§a IP Ã©s per un perÃ­ode de temps establert pel servidor. AixÃ² significa que, transcorregut aquest perÃ­ode, el client haurÃ  de renegociar la concessiÃ³ en un procÃ©s similar al descrit anteriorment.</p>
<p><center><img alt="Protocol DHCP. DORA" src="../img/ud3/protocolDHCP.png" /></center></p>
<p>El procÃ©s real, perÃ², Ã©s mÃ©s detallat. El podem repassar: consta principalment de quatre parts: la peticiÃ³ del client o <strong><em>discovery</em></strong>, lâoferta del servidor o <strong><em>offer</em></strong>, lâacceptaciÃ³ de lâadreÃ§a IP pel client o <strong><em>request</em></strong>, i la confirmaciÃ³ del servidor o <strong><em>acknowledgement</em></strong>. A part dâaquest tipus de missatges, el protocol DHCP en defineix dâaltres com el de peticiÃ³ dâinformaciÃ³ o <em>information</em> i el dâalliberament de lâadreÃ§a IP o <em>releasing</em>.</p>
<p>Els segÃ¼ents sÃ³n els tipus de paquets DHCP:</p>
<ul>
<li>DHCP <em>discover</em></li>
<li>DHCP <em>offer</em></li>
<li>DHCP <em>request</em></li>
<li>DHCP <em>ack</em> / DHCP <em>nack</em></li>
<li>DHCP <em>decline</em></li>
<li>DHCP <em>release</em></li>
<li>DHCP <em>information</em></li>
</ul>
<h4 id="dhcp-discover">DHCP <em>discover</em></h4>
<p>En un procÃ©s de configuraciÃ³ IP dâun client de DHCP el paquet DHCP <em>discover</em> Ã©s el primer que sâenvia. Lâenvia el client per tal de demanar una configuraciÃ³ IP a algun servidor. Generalment, el client sâacaba dâinicialitzar i vol obtenir una configuraciÃ³ dinÃ mica de xarxa. El client no sap a quina xarxa pertany (no tÃ© adreÃ§a IP ni mÃ scara de xarxa) i tampoc sap quins servidors DHCP hi ha en la xarxa (si nâhi ha cap).</p>
<p>Una <strong>difusiÃ³</strong> o <strong><em>broadcast</em></strong> sâadreÃ§a a la <strong>IP 255.255.255.255</strong> o a lâadreÃ§a <strong>MAC FF:FF:FF:FF:FF:FF</strong>, que Ã©s acceptada per tots els equips.</p>
<p>Per tant, el client genera un paquet de difusiÃ³ (<em>broadcast</em>) destinat a tots els equips de la xarxa on solÂ·licita una configuraciÃ³ IP. En la xarxa pot haver-hi cap, un o mÃ©s dâun servidor DHCP per atendre aquesta peticiÃ³. Ãs responsabilitat de lâadministrador de xarxes configurar correctament lâestructura i els serveis de xarxa de forma que si defineix clients de DHCP hi hagi servidors DHCP que atenguin les seves peticions.</p>
<h4 id="dhcp-offer">DHCP <em>offer</em></h4>
<p>En rebre una solÂ·licitud de configuraciÃ³ dâun client (DHCP <em>discovery</em>), un servidor DHCP mira dâatendre-la <strong>proporcionant una IP de lâinterval dâadreces dinÃ miques que gestiona</strong> (hi pot haver mÃ©s dâun servidor DHCP en la mateixa xarxa).</p>
<h4 id="dhcp-request">DHCP <em>request</em></h4>
<p>Quan el client rep una oferta de configuraciÃ³ IP per part dâun servidor, la pot acceptar o rebutjar. Si el client no accepta lâoferta, simplement realitzarÃ  un DHCP <em>discovery</em> de nou. AixÃ² Ã©s suficient perquÃ¨ el servidor sâadoni que lâoferta ha estat rebutjada.</p>
<p>Si el client accepta lâoferta, ho ha de comunicar al servidor. El mecanisme per fer-ho Ã©s mitjanÃ§ant un paquet DHCP <em>request</em> enviat un altre cop per <strong>difusiÃ³</strong>. A hores dâara, <strong>el client encara no disposa de lâadreÃ§a IP</strong> per utilitzar-la. El servidor lâha reservat, perÃ² encara no ha donat el sÃ­ definitiu perquÃ¨ sigui concedida al client.</p>
<p>El motiu pel qual el client demana quedar-se la concessiÃ³ (DHCP <em>request</em>) que ha rebut utilitzant difusiÃ³ Ã©s fer pÃºblic a tothom de la xarxa que ha acceptat una oferta dâun servidor DHCP concret. Recordeu que la peticiÃ³ del client es fa per difusiÃ³ i, per tant, pot rebre ofertes de diferents servidors DHCP. Quan accepta una de les ofertes, no ha de dir res als altres servidors que ha refusat. Simplement fent pÃºblica quina oferta accepta, la resta de servidors DHCP entenen que la seva oferta sâha rebutjat.</p>
<h4 id="dhcp-ack-dhcp-nack">DHCP <em>ack</em> / DHCP <em>nack</em></h4>
<p><strong><em>ACK</em></strong> i <strong><em>NACK</em></strong> sÃ³n dos acrÃ²nims usuals en el mÃ³n de la informÃ tica que signifiquen confirmaciÃ³ (acceptaciÃ³) i no-conformitat (refÃºs) respectivament.</p>
<p>LâÃºltim pas en una negociaciÃ³ DHCP bÃ sica el realitza el servidor quan finalment autoritza la concessiÃ³ enviant el paquet DHCPACK (DHCP <em>akcnowledgement</em>). A partir dâaquest moment, el client sÃ­ pot fer Ãºs de lâadreÃ§a IP i de la configuraciÃ³ de xarxa rebuda. DHCPACK inclou tota la informaciÃ³ referent a la durada de la concessiÃ³ i les dades necessÃ ries per gestionar quan expira.</p>
<p>El servidor anotarÃ  en el <strong>registre de concessions</strong> la que acaba de realitzar i detallarÃ  tots els aspectes dâaquesta, en especial el temps de concessiÃ³. El paquet dâacceptaciÃ³ de la concessiÃ³ <strong>DHCPACK Ã©s un paquet unidestinaciÃ³ adreÃ§at a la MAC del client</strong>.</p>
<h4 id="dhcp-decline">DHCP <em>decline</em></h4>
<p>Per la seva part, el client tambÃ© pot examinar lâadreÃ§a IP oferta pel servidor per comprovar si estÃ  en Ãºs o no. Pot fer altres proves per veure si li sembla correcta o no lâoferta rebuda del servidor. Per exemple, en el cas de renovaciÃ³ dâuna IP el client pot rebre una IP diferent a la que utilitza i no li interessa. En aquests casos, el client pot enviar un paquet DHCP <em>decline</em> al servidor per indicar que la seva oferta ha estat rebutjada.</p>
<h4 id="dhcp-release">DHCP <em>release</em></h4>
<p>Quan un client ja no necessita mÃ©s lâÃºs de la configuraciÃ³ IP que ha rebut, la pot alliberar enviant al servidor un paquet DHCP <em>release</em>. En fer-ho, el servidor afegeix lâadreÃ§a IP al conjunt dâadreces dinÃ miques que tÃ© disponibles. TambÃ© fa lâanotaciÃ³ pertinent en el <strong>registre de concessions</strong> (leases) per indicar que ha finalitzat lâÃºs de lâadreÃ§a. De totes maneres, molt sovint el client no pot arribar a emetre aquest paquet perquÃ¨ Ã©s apagat per lâusuari sense deixar temps al sistema per alliberar la IP.</p>
<h4 id="dhcp-information">DHCP <em>information</em></h4>
<p>En tot moment el client pot solÂ·licitar mÃ©s informaciÃ³ sobre la configuraciÃ³ de xarxa al servidor utilitzant un paquet DHCP <em>information</em>. En el paquet DHCP <em>offer</em> que el servidor envia al client, consten les informacions generals de configuraciÃ³ de xarxa que es trameten en lâoferta: adreÃ§a IP, mÃ scara de xarxa, porta dâenllaÃ§ predeterminada, servidor DNS, fitxer a baixar i molts altres parÃ metres que poden estar configurats per enviar-se en lâoferta. El client pot tornar a demanar al servidor la informaciÃ³ dâaquests parÃ metres o pot solÂ·licitar informaciÃ³ per a la configuraciÃ³ dâaltres parÃ metres (WINS, NetBIOS, hostname, etc.). El client nomÃ©s pot realitzar una peticiÃ³ dâinformaciÃ³ DHCP <em>information</em> al servidor un cop ja estÃ  configurat.</p>
<div class="admonition example">
<p class="admonition-title">Exemple de mala configuraciÃ³ d'un equip</p>
<p>Un exemple de mala configuraciÃ³ Ã©s la dâun equip que sâha engegat amb una adreÃ§a IP estÃ tica errÃ²nia que se solapa amb les adreces IP que reparteix el servidor. El mecanisme usat per comprovar si lâadreÃ§a IP ja estÃ  essent utilitzada Ã©s fer un <strong>ping</strong>. Si ningÃº no respon Ã©s que estÃ  lliure (segurament).</p>
<p>Quan un servidor DHCP detecta que la IP que havia reservat per a un client i que li anava a concedir ja estÃ  en Ãºs, el servidor envia al client un paquet <em>DHCPNACK</em> i indica la no-autoritzaciÃ³ de la concessiÃ³. El client que rep un <em>DHCPNACK</em> ha de tornar a iniciar tot el procÃ©s de negociaciÃ³ comenÃ§ant un altre cop pel DHCP discovery.</p>
<p>Com Ã©s possible que algun equip de la xarxa utilitze una adreÃ§a IP que forma part del conjunt dâadreces IP dinÃ miques que reparteix el servidor DHCP? La resposta Ã©s senzilla: <strong>perquÃ¨ hi ha algun equip mal configurat</strong>.</p>
</div>
<h3 id="peticio-de-renovacioconcessio-duna-ip-concreta">PeticiÃ³ de renovaciÃ³/concessiÃ³ d'una IP concreta</h3>
<p>El procÃ©s de quatre fases usuals de DHCP consistent en <em>discovery/offer/request/ack</em> es produeix quan el client solÂ·licita una IP de nou. Sabem que les concessions sÃ³n per a un interval de temps passat, la renovaciÃ³ de la qual cal que el client la demani. Existeix, doncs, un procÃ©s de renovaciÃ³ simplificat. El client demana continuar usant la mateixa IP amb un paquet DHCP <em>request</em>, i el servidor li concedeix o no amb els paquets DHCP <em>ACK/NACK</em>.</p>
<p>Un altre cas Ã©s un client que demana usar (renovar) una adreÃ§a IP que el servidor no li pot concedir (estÃ  en Ãºs, no Ã©s de lâinterval que gestiona, etc.). En aquesta situaciÃ³, el servidor envia un DHCP <em>NACK</em>.</p>
<div class="admonition note">
<p class="admonition-title">Tipus d'adreÃ§ament</p>
<p>Hi ha diversos tipus d'adreÃ§ament:</p>
<ul>
<li>UnidestinaciÃ³ o <em>unicast</em>: a un equip</li>
<li>MultidestinaciÃ³ o <em>multicast</em>: a un conjunt d'equips</li>
<li>De difusiÃ³ o <em>broadcast</em>: a tothom</li>
</ul>
</div>
<details class="question">
<summary>ACTIVITAT 1: Diagrama UDP</summary>
<p>Elabora un diagrama DHCP incloent els noms dels missatges que s'intercanvien per a establir una nova configuraciÃ³ IP, els equips que participen, ports UDP i explicacions de cada missatge.</p>
<p>A mÃ©s a mÃ©s, afig una captura de la seqÃ¼Ã¨ncia de missatges capturats amb wireshark (filtre: bootp).</p>
</details>
<h2 id="intervals-exclusions-concessions-i-reserves">Intervals, exclusions, concessions i reserves</h2>
<p>Els clients DHCP obtenen del servidor una configuraciÃ³ de xarxa. Descrivim ara alguns dels termes que tenen lloc durant aquest procÃ©s, i que formen part de la configuraciÃ³ DHCP.</p>
<p><strong>Interval</strong>: anomenen interval dâadreces IP el conjunt dâadreces dinÃ miques que el servidor tÃ© disponibles per assignar als clients. Les adreces IP disponibles sâagrupen per oferir-se a les diverses subxarxes que atÃ©n el servidor. Una mateixa subxarxa pot disposar de diversos intervals. Segurament sâentendrÃ  mÃ©s fÃ cilment amb un exemple:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span>
<span class="normal"><a href="#__codelineno-0-5">5</a></span>
<span class="normal"><a href="#__codelineno-0-6">6</a></span>
<span class="normal"><a href="#__codelineno-0-7">7</a></span>
<span class="normal"><a href="#__codelineno-0-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a>subnet 140.220.191.0 netmask 255.255.255.0 {
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>    range 140.220.191.150 140.220.191.249;
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>}
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>subnet 239.252.197.0 netmask 255.255.255.0 {
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>   range 239.252.197.10 239.252.197.107;
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>   range 239.252.197.113 239.252.197.250;
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>}
</code></pre></div></td></tr></table></div>
<p>En lâexemple anterior sâobserva que la primera subxarxa disposa d'un interval de 100 adreces dinÃ miques (de la 140.220.191.150 al 250). La segona subxarxa permet assignar dinÃ micament dos intervals d'adreces no correlatius.</p>
<p><strong>Exclusions</strong>: entenem per exclusions aquelles adreces IP que no s'ofereixen dinÃ micament per part del servidor. Ãs a dir, que no formen part de cap interval.</p>
<p><strong>Concessions</strong>: lâassignaciÃ³ dâuna adreÃ§a IP i la resta de parÃ metres de xarxa a un client per part del servidor, Ã©s una concessiÃ³ (o <em>lease</em>). Els clients reben les concessions per perÃ­odes de temps <strong>finits</strong>, que en finalitzar, cal renegociar. Tant el client com el servidor sâanoten les concessions, el client la que rep i el servidor les que concedeix. Quan finalitza una concessiÃ³ el servidor pot decidir revocar-la o ampliar-ne la concessiÃ³.</p>
<p>El client, en qualsevol moment, pot decidir renunciar a la concessiÃ³. Si el client vol allargar la concessiÃ³ inicia un diÃ leg DHCP abreujat amb el servidor que pot acabar amb una renovaciÃ³ o amb la pÃ¨rdua de la concessiÃ³ (sempre pot tornar a comenÃ§ar el procÃ©s). Tant el servidor com el client normalment miren les concessions que sâhan efectuat entre ells amb anterioritat per tal de, si Ã©s possible, repetir la mateixa assignaciÃ³.</p>
<p><strong>Reserves</strong>: anomenem reserves aquelles adreces IP que sâassignen via DHCP perÃ² <strong>de manera fixa</strong>. Ãs a dir, sÃ³n adreces que sâassignen dinÃ micament perÃ² sempre i Ãºnicament a un host determinat. Fixeu-vos que tot i ser una adreÃ§a dinÃ mica nomÃ©s sâutilitza si el host associat en fa Ãºs. Si el host estÃ  apagat lâadreÃ§a no es pot usar per a altres hosts, estÃ  reservada. Un exemple podria ser:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span>
<span class="normal"><a href="#__codelineno-1-3">3</a></span>
<span class="normal"><a href="#__codelineno-1-4">4</a></span>
<span class="normal"><a href="#__codelineno-1-5">5</a></span>
<span class="normal"><a href="#__codelineno-1-6">6</a></span>
<span class="normal"><a href="#__codelineno-1-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a>subnet 140.220.191.0 netmask 255.255.255.0 {
<a id="__codelineno-1-2" name="__codelineno-1-2"></a>   host iesserver {
<a id="__codelineno-1-3" name="__codelineno-1-3"></a>      hardware ethernet 08:00:2b:4c:59:23;
<a id="__codelineno-1-4" name="__codelineno-1-4"></a>      fixed-address 140.220.191.1;
<a id="__codelineno-1-5" name="__codelineno-1-5"></a>   }
<a id="__codelineno-1-6" name="__codelineno-1-6"></a>   range 140.220.191.150 140.220.191.249;
<a id="__codelineno-1-7" name="__codelineno-1-7"></a>}
</code></pre></div></td></tr></table></div>
<p>En aquest exemple es pot veure que l'adreÃ§a 140.220.191.1 Ã©s una adreÃ§a reservada exclusivament per al host <strong><em>iesserver</em></strong>, que sâidentifica mitjanÃ§ant la seva adreÃ§a MAC (<em>hardware ethernet</em>).</p>
<details class="question">
<summary>ACTIVITAT 2: Conceptes bÃ sics</summary>
<p>Defineix en un document els segÃ¼ents conceptes:</p>
<ul>
<li>Interval</li>
<li>Exclusions</li>
<li>Concessions</li>
<li>Reserves</li>
</ul>
<p>Crea un fitxer de configuraciÃ³ indicant exemples dels conceptes anteriors. La xarxa de treball serÃ  la 192.168.10.0/24.</p>
</details>
<h2 id="opcions-addicionals-del-protocol">Opcions addicionals del protocol</h2>
<p>Recorda que el protocol DHCP proporciona la configuraciÃ³ IP no sols una adreÃ§a IP i la mÃ scara. Per a afegir nous parÃ metres s'utilitza la paraula reservada <strong><em>option</em></strong>.</p>
<h3 id="option-subnet-mask"><em>option subnet-mask</em></h3>
<p>L'opciÃ³ <em>subnet-mask</em> s'utilitza per especificar la mÃ scara de subxarxa que s'enviarÃ  al client, si s'omet s'enviaria la mÃ scara que va associada amb la declaraciÃ³ subnet a la qual pertanyi la IP assignada. El normal Ã©s ometre-la per facilitar el manteniment del fitxer de configuraciÃ³. La seva sintaxi Ã©s la segÃ¼ent:</p>
<p><code>option subnet-mask ip-address;</code></p>
<div class="admonition example">
<p class="admonition-title">Exemple</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span>
<span class="normal"><a href="#__codelineno-2-4">4</a></span>
<span class="normal"><a href="#__codelineno-2-5">5</a></span>
<span class="normal"><a href="#__codelineno-2-6">6</a></span>
<span class="normal"><a href="#__codelineno-2-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a>subnet 10.0.0.0 netmask 255.255.255.0 {
<a id="__codelineno-2-2" name="__codelineno-2-2"></a>    range 10.0.0.10 10.0.0.254;
<a id="__codelineno-2-3" name="__codelineno-2-3"></a>    option domain-name-servers 8.8.8.8, 8.8.4.4;
<a id="__codelineno-2-4" name="__codelineno-2-4"></a>    option routers 10.0.0.1;
<a id="__codelineno-2-5" name="__codelineno-2-5"></a>    option broadcast-address 10.0.0.255;
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="hll">    option subnet-mask 255.255.255.0;
</span><a id="__codelineno-2-7" name="__codelineno-2-7"></a>}
</code></pre></div></td></tr></table></div>
</div>
<h3 id="option-routers"><em>option routers</em></h3>
<p>L'opciÃ³ <em>routers</em> s'usa per enviar-li al client la seva porta d'enllaÃ§. Pot especificar una IP numÃ¨rica o un nom. La seva sintaxi Ã©s la segÃ¼ent:</p>
<p><code>option routers ip-address;</code></p>
<div class="admonition example">
<p class="admonition-title">Exemple</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span>
<span class="normal"><a href="#__codelineno-3-4">4</a></span>
<span class="normal"><a href="#__codelineno-3-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a>subnet 10.0.0.0 netmask 255.255.255.0 {
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>    range 10.0.0.10 10.0.0.254;
<a id="__codelineno-3-3" name="__codelineno-3-3"></a>    option domain-name-servers 8.8.8.8, 8.8.4.4;
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="hll">    option routers 10.0.0.1;
</span><a id="__codelineno-3-5" name="__codelineno-3-5"></a>}
</code></pre></div></td></tr></table></div>
</div>
<h3 id="option-domain-name-servers"><em>option domain-name-servers</em></h3>
<p>L'opciÃ³ <em>domain-name-servers</em> s'empra per enviar al client els servidors DNS que utilitzarÃ . La seva sintaxi Ã©s la segÃ¼ent:</p>
<p><code>option domain-name-servers ip-address [, ip-address ...]</code></p>
<p>Els servidors s'han d'especificar <strong>per ordre de preferÃ¨ncia</strong>, sent el primer de la llista el que s'utilitzarÃ  com a servidor DNS primari.</p>
<p>Els  servidors DNS tambÃ© es poden especificar, si volem, a travÃ©s de noms que el servidor DHCP resoldrÃ  amb l'ajuda del servidor de noms especificat en la configuraciÃ³ de la xarxa de l'equip on es trobe. L'avantatge d'usar noms en comptes d'IP, Ã©s que si aquestes canvien, el nom normalment no canviarÃ  i per tant no caldrÃ  modificar la configuraciÃ³ del servidor DHCP, perÃ² l'inconvenient Ã©s que la resposta al client, que sempre serÃ  una IP, tardarÃ  una mica mÃ©s.</p>
<p>En el cas d'usar noms en comptes de IP Ã©s aconsellable instalÂ·lar al costat del servidor DHCP un servidor DNS, o si mÃ©s no que el servidor DNS estiga en el mateix segment de xarxa que el servidor DHCP, aixÃ² agilitzarÃ  bastant la resposta als clients.</p>
<div class="admonition example">
<p class="admonition-title">Exemples</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a>option domain-name-servers ns.elmeudns.com;
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a>option domain-name-servers 8.8.8.8, 8.8.4.4;
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span>
<span class="normal"><a href="#__codelineno-6-2">2</a></span>
<span class="normal"><a href="#__codelineno-6-3">3</a></span>
<span class="normal"><a href="#__codelineno-6-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a>subnet 10.0.0.0 netmask 255.255.255.0 {
<a id="__codelineno-6-2" name="__codelineno-6-2"></a>    range 10.0.0.10 10.0.0.254;
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="hll">    option domain-name-servers 8.8.8.8, 8.8.4.4
</span><a id="__codelineno-6-4" name="__codelineno-6-4"></a>}
</code></pre></div></td></tr></table></div>
</div>
<h2 id="problemes-del-servei">Problemes del servei</h2>
<h3 id="atacs-al-funcionament-de-dhcp-i-conflictes-dadreces-ip">Atacs al funcionament de DHCP i conflictes d'adreces IP</h3>
<p>Com tot servei de xarxa, el servidor DHCP Ã©s susceptible de patir atacs mal intencionats. Lâatac mÃ©s fÃ cil i clÃ ssic Ã©s el <em>DoS</em> o de denegaciÃ³ de servei. Consisteix a inundar de peticions un servidor per tal de saturar-lo i bloquejar-ne el funcionament. Un client pot realitzar innumerables peticions DHCP <em>discovery</em> fingint que sÃ³n clients diferents (emmascarant la seva MAC) amb la intenciÃ³ dâesgotar les adreces IP disponibles del servidor o simplement amb la intenciÃ³ de sobrecarregar-lo amb tantes peticions que no done a lâabast a atendre-les o que ho faci lentament.</p>
<p>Un altre tipus dâatac consisteix a falsejar la informaciÃ³ que sâenvia al client (DHCP <em>Spoofing</em>). Recordem que el client fa una solÂ·licitud dâIP en forma de difusiÃ³ (<em>broadcast</em>) i la seva peticiÃ³ pot ser atesa per un o mÃ©s servidors DHCP. Un dels servidors DHCP pot ser un atacant que intentarÃ  proporcionar informaciÃ³ de configuraciÃ³ falsa al client. Per exemple indicant un servidor DNS tambÃ© maliciÃ³s. Aquest pot falsejar les identitats de les mÃ quines de la xarxa i, quan el client sâadreÃ§a a la seva entitat bancÃ ria, el servidor DNS en realitat li ha proporcionat una IP dâuna mÃ quina que falseja la de lâentitat bancÃ ria. PerillÃ³s, veritat?</p>
<p>Per posar remei a la inseguretat en la comunicaciÃ³ client-servidor DHCP, el protocol permet utilitzar mecanismes dâautenticaciÃ³ i xifratge. Aquests mecanismes queden fora de lâabast dâaquesta explicaciÃ³.</p>
<p><center><img alt="DHCP Spoofing" src="../img/ud3/atacDHCP.png" /></center></p>
<h3 id="conflictes-amb-les-adreces-ip">Conflictes amb les adreces IP</h3>
<p>Un dels principals motius per utilitzar DHCP Ã©s simplificar el procÃ©s de configuraciÃ³ de xarxa i minimitzar els conflictes per encavalcament dâadreces IP. Per desgrÃ cia, aixÃ² no garanteix que no es puguin produir conflictes. Per exemple, ens podem trobar en situacions en quÃ¨ dues mÃ quines diferents tinguin la mateixa IP per una simple mala configuraciÃ³ del servidor DHCP. Un altre cas tÃ­pic Ã©s el dâun client que sâha configurat ell mateix una IP estÃ tica quan en la xarxa ja hi havia un equip que utilitzava la mateixa adreÃ§a IP assignada pel servidor DHCP.</p>
<p>Un problema habitual per als administradors poc experimentats Ã©s definir una configuraciÃ³ de xarxa local al client (<em>hostname</em>, servidor DNS, porta dâenllaÃ§ a utilitzar, etc.), perÃ² demanar lâadreÃ§a IP dinÃ micament. La configuraciÃ³ dinÃ mica no Ã©s solament la IP i la mÃ scara, sinÃ³ que el servidor DHCP pot proporcionar altres parÃ metres de xarxa que sobreescriuran els que el client tenia definits localment (aquest Ã©s lâobjectiu de DHCP!).</p>
<p>La configuraciÃ³ rebuda per DHCP sobreescriu la configuraciÃ³ local del client.</p>
<h3 id="diversos-servidors-dhcp-en-la-mateixa-xarxa">Diversos servidors DHCP en la mateixa xarxa</h3>
<p>Un altre dels problemes habituals Ã©s que per error o maldat es connecte a la xarxa un altre servidor DHCP que responga primer a les peticions de DHCP <em>Discover</em>. En els entorns corporatius cal tindre control de quÃ¨ es connecta a la xarxa per a evitar problemes. Aquests tipus d'escenaris es poden minimitzar indicant que el servidor Ã©s autoritari en el segment de xarxa afectat.</p>
<hr />
<details class="danger">
<summary>PRÃCTICA 1: InstalÂ·laciÃ³ i configuraciÃ³ d'un servei DHCP</summary>
<p><strong>OBJECTIUS</strong></p>
<ul>
<li>InstalÂ·lar un servei de configuraciÃ³ dinÃ mica dels parÃ metres de xarxa.</li>
<li>Presentar el servei per assignar la configuraciÃ³ bÃ sica als sistemes d'una xarxa local.</li>
<li>Realitzar assignacions dinÃ miques i estÃ tiques.</li>
</ul>
<p><strong>RECURSOS NECESSARIS</strong></p>
<ul>
<li>Un ordinador amb connexiÃ³ a Internet o una maquina virtual amb Ubuntu Server.</li>
<li>El programari ISC DHCP.</li>
<li>La guÃ­a d'instalÂ·laciÃ³:<ul>
<li><a href="https://documentation.ubuntu.com/server/how-to/networking/install-isc-dhcp-server/">How to install and configure iscp-dhcp-server</a></li>
<li><a href="https://help.ubuntu.com/community/dhcp3-server">DHCP3-server</a></li>
</ul>
</li>
</ul>
<p><strong>ENUNCIAT</strong></p>
<p>Per a la xarxa interna de l'entorn de treball instalÂ·la el servei DHCP i configura'l de forma que:</p>
<ul>
<li>Assigne dinÃ micament les 100 primeres adreces disponibles.</li>
<li>Assigne la configuraciÃ³ addicional necessÃ ria perquÃ¨ els clients DHCP puguen connectar-se a Internet.</li>
<li>Reserve la adreÃ§a IP 101 per a l'equip amb Windows.</li>
</ul>
<p><strong>ENTREGABLE</strong></p>
<p>Guia d'instalÂ·laciÃ³ i configuraciÃ³ del servei DHCP en Ubuntu incloent:</p>
<ul>
<li>Arxius de configuraciÃ³ bÃ sics.<ul>
<li>LimitaciÃ³ perquÃ¨ el DCHP sols funcione en la xarxa interna.</li>
<li>Canvis realitzats explicant els efectes.</li>
</ul>
</li>
<li>Arxiu de concessions (leases)</li>
<li>Registre del sistema on es demostre una concessiÃ³.</li>
<li>Captura del comandament: <code>sudo dhcpd -t -cf /etc/dhcp/dhcpd.conf</code></li>
<li>En Windows:<ul>
<li>ExecuciÃ³ de ipconfig /release</li>
<li>ExecuciÃ³ de ipconfig /renew</li>
<li>ComprovaciÃ³ de la configuraciÃ³ assignada al Windows XP.</li>
<li>Captura amb <em>wireshark</em> del trÃ nsit DHCP on es comprove tot el procÃ©s.</li>
</ul>
</li>
</ul>
</details>







  
  



  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Torna a l'inici
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Peu de pÃ gina" >
        
          
          <a href="../SMX2-SXA-2/" class="md-footer__link md-footer__link--prev" aria-label="Anterior: UD2. AccÃ©s remot">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Anterior
              </span>
              <div class="md-ellipsis">
                UD2. AccÃ©s remot
              </div>
            </div>
          </a>
        
        
          
          <a href="../SMX2-SXA-4/" class="md-footer__link md-footer__link--next" aria-label="SegÃ¼ent: UD4. El servei DNS">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                SegÃ¼ent
              </span>
              <div class="md-ellipsis">
                UD4. El servei DNS
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Apunts SXA - 2SMX by P.Galera & J.Beteta es troba sota llicÃ¨ncia CC BY-NC-SA 4.0 - <a href="#__consent">Canvia la configuraciÃ³ de les cookies</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="mailto:fj.galerataberner@edu.gva.es" target="_blank" rel="noopener" title="Contacte" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480v-83.6c0-4 1.5-7.8 4.2-10.8l167.6-182.8c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8l-88.3-44.2C7.1 311.3.3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  




  


<h4>Consentiment de Cookies</h4>
<p>Utilitzem cookies per reconÃ¨ixer les vostres visites i preferÃ¨ncies repetides, aixÃ­ com per mesurar l'eficÃ cia de la nostra documentaciÃ³ i si els usuaris troben el que estan cercant. Amb el vostre consentiment, ens esteu ajudant a millorar la nostra documentaciÃ³.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accepta</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Gestiona la configuraciÃ³</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.top", "navigation.footer", "toc.follow", "content.code.copy"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copiat al porta-retalls", "clipboard.copy": "C\u00f2pia al porta-retalls", "search.result.more.one": "1 m\u00e9s en aquesta p\u00e0gina", "search.result.more.other": "# m\u00e9s en aquesta p\u00e0gina", "search.result.none": "Cap document coincideix", "search.result.one": "1 document coincident", "search.result.other": "# documents coincidents", "search.result.placeholder": "Escriu per a comen\u00e7ar a cercar", "search.result.term.missing": "Desaparegut", "select.version": "Selecciona la versi\u00f3"}}</script>
    
    
      <script src="../assets/javascripts/bundle.af256bd8.min.js"></script>
      
    
  </body>
</html>