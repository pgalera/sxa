
<!doctype html>
<html lang="ca" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Paco Galera & Javier Beteta">
      
      
        <link rel="canonical" href="https://pgalera.github.io/sxa/SMX2-SXA-3/">
      
      
        <link rel="prev" href="../SMX2-SXA-2/">
      
      
        <link rel="next" href="../SMX2-SXA-4/">
      
      
      <link rel="icon" href="../img/logojaume.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.33">
    
    
      
        <title>UD3. El servei DHCP - Serveis en Xarxa</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-GJ8MB56SLW"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-GJ8MB56SLW",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-GJ8MB56SLW",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script>
  

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="UD3. El servei DHCP - Serveis en Xarxa" >
      
        <meta  property="og:description"  content="None" >
      
        <meta  property="og:image"  content="https://pgalera.github.io/sxa/assets/images/social/SMX2-SXA-3.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://pgalera.github.io/sxa/SMX2-SXA-3/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="UD3. El servei DHCP - Serveis en Xarxa" >
      
        <meta  name="twitter:description"  content="None" >
      
        <meta  name="twitter:image"  content="https://pgalera.github.io/sxa/assets/images/social/SMX2-SXA-3.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ud3-el-servei-dhcp" class="md-skip">
          Salta el contingut
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Capçalera">
    <a href=".." title="Serveis en Xarxa" class="md-header__button md-logo" aria-label="Serveis en Xarxa" data-md-component="logo">
      
  <img src="../img/logojaume.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Serveis en Xarxa
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              UD3. El servei DHCP
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Mode oscur"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Mode oscur" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Mode clar"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Mode clar" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Cerca" placeholder="Cerca" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Cerca">
        
        <button type="reset" class="md-search__icon md-icon" title="Neteja" aria-label="Neteja" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicialitzant cerca
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navegació" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Serveis en Xarxa" class="md-nav__button md-logo" aria-label="Serveis en Xarxa" data-md-component="logo">
      
  <img src="../img/logojaume.png" alt="logo">

    </a>
    Serveis en Xarxa
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Índex
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SMX2-SXA-1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD1. Interconnexió de xarxes
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SMX2-SXA-2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD2. Accés remot
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    UD3. El servei DHCP
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    UD3. El servei DHCP
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Taula de continguts">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Taula de continguts
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduccio" class="md-nav__link">
    <span class="md-ellipsis">
      Introducció
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Introducció">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evolucio-del-protocol-dhcp" class="md-nav__link">
    <span class="md-ellipsis">
      Evolució del protocol DHCP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#un-servei-clientservidor" class="md-nav__link">
    <span class="md-ellipsis">
      Un servei client/servidor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Un servei client/servidor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#el-client-dhcp" class="md-nav__link">
    <span class="md-ellipsis">
      El client DHCP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="El client DHCP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuracio-del-client" class="md-nav__link">
    <span class="md-ellipsis">
      Configuració del client
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#el-servidor-dhcp" class="md-nav__link">
    <span class="md-ellipsis">
      El servidor DHCP
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuracio-dun-equip-de-xarxa" class="md-nav__link">
    <span class="md-ellipsis">
      Configuració d'un equip de xarxa
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuració d'un equip de xarxa">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tipus-dassignacions-dadreces-ip" class="md-nav__link">
    <span class="md-ellipsis">
      Tipus d'assignacions d'adreces IP
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#el-model-funcional-dhcp" class="md-nav__link">
    <span class="md-ellipsis">
      El model funcional DHCP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="El model funcional DHCP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#udp-en-les-transmissions-dhcp" class="md-nav__link">
    <span class="md-ellipsis">
      UDP en les transmissions DHCP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UDP en les transmissions DHCP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dhcp-discover" class="md-nav__link">
    <span class="md-ellipsis">
      DHCP discover
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dhcp-offer" class="md-nav__link">
    <span class="md-ellipsis">
      DHCP offer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dhcp-request" class="md-nav__link">
    <span class="md-ellipsis">
      DHCP request
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dhcp-ack-dhcp-nack" class="md-nav__link">
    <span class="md-ellipsis">
      DHCP ack / DHCP nack
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dhcp-decline" class="md-nav__link">
    <span class="md-ellipsis">
      DHCP decline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dhcp-release" class="md-nav__link">
    <span class="md-ellipsis">
      DHCP release
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dhcp-information" class="md-nav__link">
    <span class="md-ellipsis">
      DHCP information
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#peticio-de-renovacioconcessio-duna-ip-concreta" class="md-nav__link">
    <span class="md-ellipsis">
      Petició de renovació/concessió d'una IP concreta
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#intervals-exclusions-concessions-i-reserves" class="md-nav__link">
    <span class="md-ellipsis">
      Intervals, exclusions, concessions i reserves
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#opcions-addicionals-del-protocol" class="md-nav__link">
    <span class="md-ellipsis">
      Opcions addicionals del protocol
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Opcions addicionals del protocol">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#option-subnet-mask" class="md-nav__link">
    <span class="md-ellipsis">
      option subnet-mask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#option-routers" class="md-nav__link">
    <span class="md-ellipsis">
      option routers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#option-domain-name-servers" class="md-nav__link">
    <span class="md-ellipsis">
      option domain-name-servers
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#problemes-del-servei" class="md-nav__link">
    <span class="md-ellipsis">
      Problemes del servei
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Problemes del servei">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#atacs-al-funcionament-de-dhcp-i-conflictes-dadreces-ip" class="md-nav__link">
    <span class="md-ellipsis">
      Atacs al funcionament de DHCP i conflictes d'adreces IP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conflictes-amb-les-adreces-ip" class="md-nav__link">
    <span class="md-ellipsis">
      Conflictes amb les adreces IP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diversos-servidors-dhcp-en-la-mateixa-xarxa" class="md-nav__link">
    <span class="md-ellipsis">
      Diversos servidors DHCP en la mateixa xarxa
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SMX2-SXA-4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD4. El servei DNS
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Manuals
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Manuals
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../manuals/CanviMirror/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Canvi de Mirror en Ubuntu
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../manuals/ManUbuntuServerDocker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker en Ubuntu Server
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../manuals/ManSolMachine_id/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Duplicació Machine-id
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Taula de continguts">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Taula de continguts
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduccio" class="md-nav__link">
    <span class="md-ellipsis">
      Introducció
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Introducció">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evolucio-del-protocol-dhcp" class="md-nav__link">
    <span class="md-ellipsis">
      Evolució del protocol DHCP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#un-servei-clientservidor" class="md-nav__link">
    <span class="md-ellipsis">
      Un servei client/servidor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Un servei client/servidor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#el-client-dhcp" class="md-nav__link">
    <span class="md-ellipsis">
      El client DHCP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="El client DHCP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuracio-del-client" class="md-nav__link">
    <span class="md-ellipsis">
      Configuració del client
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#el-servidor-dhcp" class="md-nav__link">
    <span class="md-ellipsis">
      El servidor DHCP
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuracio-dun-equip-de-xarxa" class="md-nav__link">
    <span class="md-ellipsis">
      Configuració d'un equip de xarxa
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuració d'un equip de xarxa">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tipus-dassignacions-dadreces-ip" class="md-nav__link">
    <span class="md-ellipsis">
      Tipus d'assignacions d'adreces IP
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#el-model-funcional-dhcp" class="md-nav__link">
    <span class="md-ellipsis">
      El model funcional DHCP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="El model funcional DHCP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#udp-en-les-transmissions-dhcp" class="md-nav__link">
    <span class="md-ellipsis">
      UDP en les transmissions DHCP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UDP en les transmissions DHCP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dhcp-discover" class="md-nav__link">
    <span class="md-ellipsis">
      DHCP discover
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dhcp-offer" class="md-nav__link">
    <span class="md-ellipsis">
      DHCP offer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dhcp-request" class="md-nav__link">
    <span class="md-ellipsis">
      DHCP request
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dhcp-ack-dhcp-nack" class="md-nav__link">
    <span class="md-ellipsis">
      DHCP ack / DHCP nack
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dhcp-decline" class="md-nav__link">
    <span class="md-ellipsis">
      DHCP decline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dhcp-release" class="md-nav__link">
    <span class="md-ellipsis">
      DHCP release
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dhcp-information" class="md-nav__link">
    <span class="md-ellipsis">
      DHCP information
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#peticio-de-renovacioconcessio-duna-ip-concreta" class="md-nav__link">
    <span class="md-ellipsis">
      Petició de renovació/concessió d'una IP concreta
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#intervals-exclusions-concessions-i-reserves" class="md-nav__link">
    <span class="md-ellipsis">
      Intervals, exclusions, concessions i reserves
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#opcions-addicionals-del-protocol" class="md-nav__link">
    <span class="md-ellipsis">
      Opcions addicionals del protocol
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Opcions addicionals del protocol">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#option-subnet-mask" class="md-nav__link">
    <span class="md-ellipsis">
      option subnet-mask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#option-routers" class="md-nav__link">
    <span class="md-ellipsis">
      option routers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#option-domain-name-servers" class="md-nav__link">
    <span class="md-ellipsis">
      option domain-name-servers
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#problemes-del-servei" class="md-nav__link">
    <span class="md-ellipsis">
      Problemes del servei
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Problemes del servei">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#atacs-al-funcionament-de-dhcp-i-conflictes-dadreces-ip" class="md-nav__link">
    <span class="md-ellipsis">
      Atacs al funcionament de DHCP i conflictes d'adreces IP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conflictes-amb-les-adreces-ip" class="md-nav__link">
    <span class="md-ellipsis">
      Conflictes amb les adreces IP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diversos-servidors-dhcp-en-la-mateixa-xarxa" class="md-nav__link">
    <span class="md-ellipsis">
      Diversos servidors DHCP en la mateixa xarxa
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="ud3-el-servei-dhcp">UD3. El servei DHCP</h1>
<h2 id="introduccio">Introducció</h2>
<p>L’administrador de xarxa té la tasca de configurar els equips que la componen. Això significa configurar els servidors, els equips client, concentradors, encaminadors, etc. Cada equip de la xarxa s’ha d’identificar amb l’adreça IP corresponent i la màscara de xarxa, i generalment disposarà d’un camí d’accés a Internet.</p>
<p>Tant els usuaris com els serveis requeriran l’accés a altres equips identificant-los pel nom de domini en lloc de fer-ho per l’adreça IP, que és més difícil de recordar. Fer això equip per equip resulta una feina pesada i repetitiva si no es disposa de serveis de xarxa que la faciliten.</p>
<p>El servei DHCP permet la configuració d’adreces IP, màscares, passarel·les per defecte i moltes altres opcions de configuració de manera totalment dinàmica. DHCP és l’acrònim de dynamic host configuration protocol, en català, protocol de configuració dinàmica d’equips.</p>
<div class="admonition note">
<p class="admonition-title">Què fa el DHCP?</p>
<p>Una forma planera d’entendre el DHCP és imaginar que els equips de client en arrencar fan un crit per la xarxa i pregunten <strong><em>hi ha algú?</em></strong>, <strong><em>qui sóc jo?</em></strong>. El servidor de DHCP els contesta proporcionant-los tota la informació necessària perquè sàpiguen qui són i com han de configurar els seus paràmetres de xarxa.</p>
</div>
<p>El servei DHCP proporciona un mecanisme de configuració centralitzat dels equips de la xarxa. En lloc de configurar un per un els equips de xarxa amb adreces i valors estàtics, un servidor DHCP anirà assignant als equips clients els valors que els corresponguin. Aquesta assignació es fa per un període de temps finit, passat el qual caldrà renovar-se.</p>
<p>Els principals avantatges d’utilitzar DHCP són: d’una banda, <strong>evitar conflictes</strong> d’adreces IP (adreces repetides i adreces errònies), ja que passar equip per equip a canviar la configuració és molt més pesat i propens a l’error que fer-ho editant un sol fitxer de configuració en el servidor DHCP; i, d’altra banda, poder fer l’<strong>administració centralitzada</strong> representa un estalvi de temps i de feina.</p>
<p>El servei DHCP <strong>simplifica l’administració</strong> de la configuració dels equips de xarxa fent-la centralitzada, dinàmica i amb concessions per períodes de temps finits.</p>
<p>La concessió dinàmica d’adreces IP i altres paràmetres de configuració de xarxa es realitza per a un període de temps determinat, que varia en funció de les necessitats del client i del servidor.</p>
<div class="admonition note">
<p class="admonition-title">Avantatges DHCP</p>
<p>El servei DHCP té diversos avantatges:</p>
<ul>
<li>Centralitza l'administració</li>
<li>Evita errors i conflictes IP</li>
<li>Estalvia temps</li>
<li>Simplifica l'administració</li>
</ul>
</div>
<div class="admonition example">
<p class="admonition-title">Exemples d'ús del servei DHCP</p>
<ul>
<li>En una biblioteca que admet connexions Wi-Fi, els clients obtindran concessions per a un temps reduït, per exemple, minuts.</li>
<li>Un usuari d’Internet que rep al seu equip de casa una adreça IP dinàmica del seu proveïdor d’accés a Internet (ISP) tindrà una concessió que segurament serà per hores.</li>
<li>En la xarxa corporativa d’una empresa que s’ha configurat dinàmicament usant DHCP, els equips rebran concessions dinàmiques per períodes de temps molt llargs, per exemple, dies.</li>
</ul>
</div>
<h3 id="evolucio-del-protocol-dhcp">Evolució del protocol DHCP</h3>
<p>El protocol DHCP ve descrit, com la majoria de protocols de xarxa, per un document oficial anomenat <strong>RFC</strong>. Al llarg dels anys ha sofert diverses evolucions per anar-se adaptant a les necessitats de cada moment. Tot protocol implica un diàleg entre els equips que hi intervenen, ens caldrà doncs analitzar quin és i com es produeix aquest diàleg.</p>
<details class="info">
<summary>Evolució del protocol DHCP</summary>
<p>El servei DHCP és un servei del tipus client-servidor que proporciona la configuració de xarxa als clients que ho sol·liciten. Proporciona els paràmetres bàsics de xarxa com l’adreça IP, la màscara de xarxa, la porta d’enllaç i també d’altres paràmetres necessaris per a una connexió en una xarxa IP. Es tracta d’un protocol de la capa d’aplicació del model TCP/IP.</p>
<p>El protocol DHCP està basat en l’arquitectura de serveis client-servidor i utilitza com a transport el protocol UDP de la pila de protocols TCP/ IP. El servidor DHCP es comunica amb els clients utilitzant paquets UDP, que rep en el seu port 67 i envia al port 68 del client.</p>
<p>La configuració dinàmica d’equips de xarxa es va iniciar amb el protocol BOOTP (BOOT strap protocol, protocol d’arrencada). Un protocol més bàsic que principalment permetia definir l’adreça IP, la màscara de xarxa i la passarel·la per defecte per al client. El protocol BOOTP (RFC 951, any 1985) és un protocol pensat per proporcionar automàticament la IP a clients de xarxa en el procés d’arrencada. Originàriament s’utilitzava per a estacions de treball sense disc que obtenien la configuració de xarxa del protocol BOOTP i també obtenien el nom d’un fitxer d’arrencada que s’havia de baixar per mitjà del TFTP, que usualment era el sistema operatiu.</p>
<p>El BOOTP va donar pas al protocol DHCP, que n’és una evolució amb moltes més prestacions. El DHCP sorgeix l’octubre del 1993 a través de l’RFC 1531. Ràpidament evoluciona per mitjà de diverses RFC, com l’RFC 1541 el mateix any 1993, que serà substituïda per l’RFC 2131 el març del 1997. Aquest document és la base del protocol DHCP actual. A grans trets, el protocol es descriu en l’RFC 2131 per a xarxes Ipv4, el conjunt d’opcions de configuració de DHCP es descriuen en l’RFC 2132, i l’especificació de DHCP per a xarxes Ipv6 és en l’RFC 3315.</p>
<p><strong>PRINCIPALS RFC DEDICADES A DHCP:</strong></p>
<ul>
<li>RFC 2131. Març 1997. DHCP dynamic host configuration protocol.</li>
<li>RFC 2132. DHCP options.</li>
<li>RFC 3396. Encoding long options.</li>
<li>RFC 4361. No especific client identifications for dhcpv4.</li>
<li>RFC 3315. DHCPv6 dinamic host configuration protocol Ipv6.</li>
</ul>
<p>Els Request for Comments (RFC) són memoràndums sobre noves investigacions, innovacions i metodologies relacionades amb les tecnologies d’Internet. Quan els publica l’IETF (Internet Engineering Task Force) defineixen a escala mundial els protocols i les seves revisions. És a dir, són les publicacions oficials que descriuen els protocols.</p>
</details>
<h3 id="un-servei-clientservidor">Un servei client/servidor</h3>
<p>Com acostuma a passar amb els serveis client/servidor, un equip pot realitzar les dues funcions al mateix temps.</p>
<p>El servei DHCP és un més dels serveis de xarxa que tenen l’estructura client /servidor. Els servidors DHCP són els equips que tenen en execució el programa servidor. És el programa encarregat d’atendre les peticions dels clients i oferir-los la configuració de xarxa, <strong>tot portant el registre de les IP que concedeix i el registre de totes les accions que realitza</strong>. Els clients DHCP són aquells equips que realitzen peticions per obtenir una configuració de xarxa a un servidor DHCP.</p>
<h4 id="el-client-dhcp">El client DHCP</h4>
<p>Un equip client DHCP és un equip que sol·licita la IP i altres paràmetres de configuració de xarxa a un servidor DHCP en lloc de tenir-los definits localment en l’equip.</p>
<div class="admonition note">
<p class="admonition-title">ISP</p>
<p><strong>ISP</strong>: <em>Internet service provider</em> o proveïdor de servei/accés a Internet. Ho són per exemple les empreses Movistar, Vodafone, Jazztel, etc.</p>
</div>
<p>Si connecteu el vostre equip informàtic a la xarxa Internet per mitjà d’un ISP, segurament rebreu una IP dinàmica del vostre proveïdor. Quan es realitzava una trucada telefònica amb mòdem i usant el protocol PPP (<em>point to point protocol</em>, protocol punt a punt), el proveïdor proporcionava una adreça IP dinàmica. Si utilitzeu ADSL i un encaminador o router, segurament l’encaminador us proporciona una adreça IP dinàmica privada a l’ordinador de casa. Al mateix temps, l’encaminador obté una IP dinàmica pública del proveïdor. Aquestes adreces IP dinàmiques són fixes (sempre les mateixes) o dinàmiques d’interval (pot ser qualsevol IP del conjunt d’adreces IP que té disponibles per concedir el servidor DHCP).</p>
<div class="admonition note">
<p class="admonition-title">IP pública / IP privada</p>
<p>La diferència entre una IP pública i una IP privada és que la pública és visible per a tots els equips d’Internet, mentre que la privada és visible només dins de la mateixa xarxa local.</p>
</div>
<p>El client DHCP ha de tenir en funcionament un dimoni (<em>daemon</em>) encarregat de la gestió de les tasques DHCP per part del client. El programa client realitza la part de negociació encarregada al client (<em>DHCP discovery, request</em>) i també porta un registre de les concessions (<em>leases</em>) rebudes. Aquest registre és el que utilitza el client per tornar a demanar la mateixa IP que tenia anteriorment. Un cop rebuda la concessió el programa client queda “adormit”, pendent de tornar-se a executar automàticament quan calgui renegociar la concessió. Sense intervenció de l’usuari, el programa client s’activa i segueix el procediment necessari per renegociar l’adreça IP cada cop que el temps de la concessió s'esgota.</p>
<h5 id="configuracio-del-client">Configuració del client</h5>
<p>Usualment les configuracions clients es poden fer de tres maneres diferents:</p>
<ul>
<li>fitxer de text: editar directament els fitxers de configuració.</li>
<li>menús en mode text: usant algun programa de menús amb interfície de text.</li>
<li>aplicació gràfica: usant una aplicació de finestres en l’entorn gràfic.</li>
</ul>
<p>Els programes client varien d’un sistema operatiu a un altre i la manera d’executar-los també. Generalment es disposa d’un client executable en mode text o ordres i d’una interfície gràfica (GUI, <em>graphics user interface</em> o interfície gràfica d’usuari) per a la configuració. No cal dir que els sistemes Windows tendeixen a la configuració gràfica usant finestres i a la configuració i execució interna d’amagat de l’usuari. Normalment, en els sistemes GNU/Linux, la configuració es fa usant fitxers de text o com a opcions en l’ordre d’execució. La interfície gràfica acostuma a ser un frontal (<em>front-end</em>) per cridar l’ordre. Segons sigui el sistema operatiu es pot consultar el fitxer de registre de les concessions rebudes pel client, el fitxer de <em>leases</em>, més o menys detalladament.</p>
<p>Generalment el programa client es pot configurar per definir-ne el comportament en la comunicació amb el servidor: informació a demanar, informació a proporcionar al servidor, opcions per defecte, etc.</p>
<h4 id="el-servidor-dhcp">El servidor DHCP</h4>
<p>L'administrador de xarxa és l'encarregat de pensar la ubicació del servidor o servidors DHCP en l'estructura corporativa. Com més complicada sigui la topologia de la xarxa, més difícil en serà la gestió. Una xarxa corporativa bàsica pot disposar d'un únic servidor DHCP que ofereix els seus serveis a tots els equips de la xarxa. Els clients poden estar en una mateixa subxarxa o en diverses subxarxes, però totes amb connectivitat amb el servidor DHCP. Aquest també pot ser l'esquema d'una xarxa privada a casa, on un router (el de l’ISP, per exemple) proporciona el servei DHCP a tots els ordinadors de la casa.</p>
<p>Si la xarxa corporativa creix i passa a tenir subxarxes segmentades amb tallafocs les unes de les altres, la configuració del servidor DHCP es complica. Si es vol continuar amb un únic servidor per a tota la xarxa, caldrà que els tallafocs (<em>firewalls</em>) deixin passar els paquets DHCP entre les subxarxes i el servidor. Una altra opció és posar un servidor DHCP per a cada subxarxa o grups de subxarxes. Fent-ho així, l’administració de cada servidor és més senzilla però hi ha més servidors a administrar. Una xarxa amb una casuística completa és la que té diversos servidors DHCP per a diverses parts de la xarxa i tallafocs entre clients i servidors que han de permetre el pas de paquets DHCP.</p>
<p>Si el servidor DHCP és l’encarregat de donar adreces IP als clients, qui li proporciona una adreça IP a ell? O bé un altre servidor DHCP (i podríem tornar a fer la mateixa pregunta indefinidament) o bé l’administrador. <strong>Usualment, en una xarxa corporativa el servidor DHCP utilitza una IP estàtica definida per l’administrador</strong>. Això li permet estar sempre disponible per als clients amb la mateixa IP i no el fa dependre d’un altre servidor extern.</p>
<p>Hi ha diversos programes servidors DHCP: en mode text, en mode gràfic, en mode “màgic” (no es veu què fan) i en mode Unix (tot basat en fitxers de text). Cada administrador treballa amb les seves eines preferides. Les tasques bàsiques per aprendre a utilitzar un servidor DHCP són:
- Observar/fer una llista de la configuració actual.
- Activar/aturar el servei.
- Modificar la configuració.
- Monitorar els logs (registre de successos del servei).
- Saber instal·lar i desinstal·lar l’aplicació servidor.</p>
<p>Els fitxers de logs (successos) recullen els esdeveniments que es volen monitorar.</p>
<p>Com la majoria de serveis de xarxa, el servei DHCP és un servei que s’executa en segon pla en forma de dimoni. El servidor DHCP sempre està engegat escoltant en el <strong>port 67</strong> les peticions que rep dels clients. Quan rep una petició entrant, el programa executable del servidor DHCP la processa i posa en marxa tot el mecanisme DHCP pertinent per tornar a escoltar noves peticions. De fet, el servidor sempre escolta peticions i les processa simultàniament (segons la configuració).</p>
<p>Els fitxers del registre del servei, on s’anoten les concessions, permeten mantenir la informació encara que el servei s’aturi o que el servidor s’apagui. En tornar a engegar es llegiran de nou els fitxers de registres per tal de saber quines són les concessions que s’havien realitzat.</p>
<p>Els fitxers de concessions permeten mantenir la coherència de l’assignació d’adreces IP entre aturades del servei.</p>
<h2 id="configuracio-dun-equip-de-xarxa">Configuració d'un equip de xarxa</h2>
<p>Qualsevol equip que pertany a una xarxa requereix que es configure amb uns paràmetres mínims, que són l’<strong>adreça IP</strong>, la <strong>màscara</strong> i la <strong>porta d’enllaç</strong> per defecte. L’adreça IP identifica l’equip de manera única, i la màscara permet determinar la xarxa o subxarxa en què es troba l’equip. Amb aquests dos paràmetres n’hi ha prou per tenir connectivitat en la xarxa. Si es vol disposar d’accés fora de la xarxa pròpia (per exemple, a Internet o a la resta de la xarxa corporativa) cal definir també la porta d’enllaç predeterminada. A part de la configuració bàsica, els equips poden necessitar (i de fet ho necessiten) més paràmetres de configuració com, per exemple: el <strong>nom del host</strong>, el <strong>servidor DNS</strong>, el fitxer d’iniciació a baixar, etc.</p>
<details class="example">
<summary>Exemple de configuració de xarxa d'un equip de casa</summary>
<p>La majoria d’usuaris disposen a casa d’un equip (o més) connectats a un router que proporciona l’accés a Internet. Aquest equip està configurat com a client DHCP i en iniciar-se rep la configuració de xarxa del router. Podeu comprovar a casa quina configuració teniu. Una configuració d’exemple podria ser:</p>
<p><center></p>
<table>
<thead>
<tr>
<th style="text-align: center;"><strong>Paràmetre</strong></th>
<th style="text-align: center;">Valor</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><strong>Adreça IP</strong></td>
<td style="text-align: center;">192.168.1.33</td>
</tr>
<tr>
<td style="text-align: center;"><strong>Màscara de subxarxa</strong></td>
<td style="text-align: center;">255.255.255.0</td>
</tr>
<tr>
<td style="text-align: center;"><strong>Porta d'enllaç</strong></td>
<td style="text-align: center;">192.168.1.1</td>
</tr>
<tr>
<td style="text-align: center;"><strong>Servidor DHCP</strong></td>
<td style="text-align: center;">192.168.1.1</td>
</tr>
<tr>
<td style="text-align: center;"><strong>Servidors DNS</strong></td>
<td style="text-align: center;">8.8.8.8 - 8.8.4.4</td>
</tr>
</tbody>
</table>
<p></center></p>
</details>
<p><strong>Inconvenient de la configuració estàtica</strong></p>
<p>La configuració estàtica implica configurar els equips un a un. Fins i tot encara que es tinga accés remot als equips (per Telnet o SSH), com que cal modificar la configuració de xarxa no es pot fer assegut des de l’equip de l’administrador, sinó que cal anar equip per equip a modificar la configuració.</p>
<p>Aquest procés de configuració cal que es faci per a cada equip de la xarxa. Fer-lo manualment implica configurar equip per equip sense cometre errades en teclejar les adreces i les màscares. Qualsevol canvi en l’estructura de la xarxa, com per exemple redefinir les subxarxes o modificar algunes adreces IP, significa tornar a configurar manualment els equips implicats. És evident que tota aquesta feinada no és agradable per a l’administrador de xarxa (i és molt avorrida!). Tant si la xarxa corporativa consta de pocs equips com de molts, cal una solució que permeti automatitzar la configuració de xarxa de cada equip de manera centralitzada.</p>
<p>Les opcions de configuració de xarxa es poden assignar a cada equip estàticament o es poden configurar de manera dinàmica utilitzant DHCP.</p>
<p>Com a administradors de xarxa, la gestió centralitzada que ens proporciona DHCP ens permet modificar la xarxa afegint, eliminant i redefinint, equips amb un cost mínim.</p>
<h3 id="tipus-dassignacions-dadreces-ip">Tipus d'assignacions d'adreces IP</h3>
<p>Cada equip de xarxa té assignada una adreça IP que l’identifica de manera única dins la xarxa. La composició de l’adreça IP i la màscara determina la xarxa o subxarxa a la qual pertany. A més a més, es configuren altres paràmetres de xarxa com la porta d’enllaç predeterminada, servidors DNS, etc. Això es pot configurar manualment anant equip per equip i introduint aquesta informació.</p>
<p>Quan l’adreça IP i els altres paràmetres necessaris de configuració de la xarxa es configuren equip per equip, manualment, es diu que tenen una <strong>configuració IP estàtica</strong>.</p>
<p>Quan la configuració de xarxa d'un equip no es fa manualment i localment en l’equip sinó que es rep per mitjà d’un servidor DHCP, es diu que l’equip utilitza una <strong>configuració IP dinàmica</strong>. Per realitzar configuracions de xarxa dinàmicament caldran un o més servidors de DHCP (a manera de redundància) que proporcionaran la configuració als equips clients (els que cal configurar). Per tant, serà una estructura client-servidor. Les adreces IP dinàmiques que rep el client les podem classificar en dues categories: assignació dinàmica d'interval i assignació fixa.</p>
<p>El servidor DHCP disposa d’un interval d’adreces que pot assignar als clients que demanen una adreça IP. Quan el servidor assigna una adreça qualsevol de l’interval al client (a l’atzar) es tracta d’una assignació dinàmica d’interval. El client no sap quina adreça IP tindrà i no hi ha manera de predir quina adreça se li concedirà en una futura configuració. A cada nova assignació l’adreça IP pot ser diferent.</p>
<p>Una assignació fixa es produeix quan el servidor DHCP sempre assigna la mateixa adreça al client. Per assignar sempre la mateixa adreça IP al client cal que el servidor pugui identificar inequívocament el client (per l’adreça MAC). El servidor disposa d’una taula amb les correspondències entre les adreces MAC i les adreces IP fixes.</p>
<p>Quan la configuració de xarxa d’un equip es rep per mitjà d’un servidor DHCP es diu que utilitza una <strong>adreça IP dinàmica</strong>. Aquesta adreça pot variar dins d’un interval d’adreces disponibles per al servidor DHCP o pot ser fixa. Si l'assignació de la configuració es fa per a sempre es diu que es fa una assignació de <strong>configuració IP automàtica</strong>.</p>
<p>Els avantatges de disposar d’una IP fixa són que la vostra identificació a Internet (la vostra adreça IP) no varia i tothom us pot identificar sempre per la mateixa IP. Podeu proporcionar serveis a altres equips, els clients us identifiquen sempre amb la mateixa adreça sense haver de recordar en cada moment quina adreça IP teniu avui (com passa en el cas d’una IP dinàmica).</p>
<div class="admonition note">
<p class="admonition-title">MAC</p>
<p><strong>MAC</strong>: Cada interfície de xarxa s’identifica de manera única físicament per l’adreça MAC (<em>media acces control</em>, adreça d’accés al medi).</p>
</div>
<h2 id="el-model-funcional-dhcp">El model funcional DHCP</h2>
<p>El protocol DHCP utilitza UDP en la capa de transport. Utilitza dos ports:</p>
<ul>
<li><strong>Port 67</strong>: on escolta el servidor</li>
<li><strong>Port 68</strong>: on escolta el client</li>
</ul>
<p>El protocol DHCP descriu el diàleg que es produeix entre client i servidor per a la concessió de configuracions IP. En una xarxa amb configuració d’equips dinàmica, un o més servidors DHCP escoltaran les peticions dels clients en el port 67. Els clients DHCP sol·licitaran al servidor DHCP una configuració IP, i començarà un procés de negociació que ha d’acabar (si tot va bé) amb la concessió d’una adreça IP al client. Els servidors parlen al port 68 dels clients.</p>
<p>La negociació que s’estableix es pot definir a grans trets de la manera següent:</p>
<ol>
<li>El client sol·licita una adreça IP (de fet, una configuració de xarxa).</li>
<li>El servidor mira les adreces IP disponibles dins de l’interval d’adreces dinàmiques de què disposa per concedir i n’ofereix una al client.</li>
<li>Si el client l’accepta, envia una sol·licitud al servidor per fer-la seva.</li>
<li>Si al servidor li sembla bé, accepta la petició del client i li confirma que pot utilitzar aquesta IP, que la hi concedeix per un període de temps limitat.</li>
</ol>
<h3 id="udp-en-les-transmissions-dhcp">UDP en les transmissions DHCP</h3>
<p>L’intercanvi d’informació entre client i servidor no és massa gran (poc volum de dades) i no requereix un flux permanent (una conversa continuada). És per això que el protocol que s’utilitza en les transmissions DHCP és l’UDP.</p>
<p>La concessió de l’adreça IP és per un període de temps establert pel servidor. Això significa que, transcorregut aquest període, el client haurà de renegociar la concessió en un procés similar al descrit anteriorment.</p>
<p><center><img alt="Protocol DHCP. DORA" src="../img/ud3/protocolDHCP.png" /></center></p>
<p>El procés real, però, és més detallat. El podem repassar: consta principalment de quatre parts: la petició del client o <strong><em>discovery</em></strong>, l’oferta del servidor o <strong><em>offer</em></strong>, l’acceptació de l’adreça IP pel client o <strong><em>request</em></strong>, i la confirmació del servidor o <strong><em>acknowledgement</em></strong>. A part d’aquest tipus de missatges, el protocol DHCP en defineix d’altres com el de petició d’informació o <em>information</em> i el d’alliberament de l’adreça IP o <em>releasing</em>.</p>
<p>Els següents són els tipus de paquets DHCP:</p>
<ul>
<li>DHCP <em>discover</em></li>
<li>DHCP <em>offer</em></li>
<li>DHCP <em>request</em></li>
<li>DHCP <em>ack</em> / DHCP <em>nack</em></li>
<li>DHCP <em>decline</em></li>
<li>DHCP <em>release</em></li>
<li>DHCP <em>information</em></li>
</ul>
<h4 id="dhcp-discover">DHCP <em>discover</em></h4>
<p>En un procés de configuració IP d’un client de DHCP el paquet DHCP <em>discover</em> és el primer que s’envia. L’envia el client per tal de demanar una configuració IP a algun servidor. Generalment, el client s’acaba d’inicialitzar i vol obtenir una configuració dinàmica de xarxa. El client no sap a quina xarxa pertany (no té adreça IP ni màscara de xarxa) i tampoc sap quins servidors DHCP hi ha en la xarxa (si n’hi ha cap).</p>
<p>Una <strong>difusió</strong> o <strong><em>broadcast</em></strong> s’adreça a la <strong>IP 255.255.255.255</strong> o a l’adreça <strong>MAC FF:FF:FF:FF:FF:FF</strong>, que és acceptada per tots els equips.</p>
<p>Per tant, el client genera un paquet de difusió (<em>broadcast</em>) destinat a tots els equips de la xarxa on sol·licita una configuració IP. En la xarxa pot haver-hi cap, un o més d’un servidor DHCP per atendre aquesta petició. És responsabilitat de l’administrador de xarxes configurar correctament l’estructura i els serveis de xarxa de forma que si defineix clients de DHCP hi hagi servidors DHCP que atenguin les seves peticions.</p>
<h4 id="dhcp-offer">DHCP <em>offer</em></h4>
<p>En rebre una sol·licitud de configuració d’un client (DHCP <em>discovery</em>), un servidor DHCP mira d’atendre-la <strong>proporcionant una IP de l’interval d’adreces dinàmiques que gestiona</strong> (hi pot haver més d’un servidor DHCP en la mateixa xarxa).</p>
<h4 id="dhcp-request">DHCP <em>request</em></h4>
<p>Quan el client rep una oferta de configuració IP per part d’un servidor, la pot acceptar o rebutjar. Si el client no accepta l’oferta, simplement realitzarà un DHCP <em>discovery</em> de nou. Això és suficient perquè el servidor s’adoni que l’oferta ha estat rebutjada.</p>
<p>Si el client accepta l’oferta, ho ha de comunicar al servidor. El mecanisme per fer-ho és mitjançant un paquet DHCP <em>request</em> enviat un altre cop per <strong>difusió</strong>. A hores d’ara, <strong>el client encara no disposa de l’adreça IP</strong> per utilitzar-la. El servidor l’ha reservat, però encara no ha donat el sí definitiu perquè sigui concedida al client.</p>
<p>El motiu pel qual el client demana quedar-se la concessió (DHCP <em>request</em>) que ha rebut utilitzant difusió és fer públic a tothom de la xarxa que ha acceptat una oferta d’un servidor DHCP concret. Recordeu que la petició del client es fa per difusió i, per tant, pot rebre ofertes de diferents servidors DHCP. Quan accepta una de les ofertes, no ha de dir res als altres servidors que ha refusat. Simplement fent pública quina oferta accepta, la resta de servidors DHCP entenen que la seva oferta s’ha rebutjat.</p>
<h4 id="dhcp-ack-dhcp-nack">DHCP <em>ack</em> / DHCP <em>nack</em></h4>
<p><strong><em>ACK</em></strong> i <strong><em>NACK</em></strong> són dos acrònims usuals en el món de la informàtica que signifiquen confirmació (acceptació) i no-conformitat (refús) respectivament.</p>
<p>L’últim pas en una negociació DHCP bàsica el realitza el servidor quan finalment autoritza la concessió enviant el paquet DHCPACK (DHCP <em>akcnowledgement</em>). A partir d’aquest moment, el client sí pot fer ús de l’adreça IP i de la configuració de xarxa rebuda. DHCPACK inclou tota la informació referent a la durada de la concessió i les dades necessàries per gestionar quan expira.</p>
<p>El servidor anotarà en el <strong>registre de concessions</strong> la que acaba de realitzar i detallarà tots els aspectes d’aquesta, en especial el temps de concessió. El paquet d’acceptació de la concessió <strong>DHCPACK és un paquet unidestinació adreçat a la MAC del client</strong>.</p>
<h4 id="dhcp-decline">DHCP <em>decline</em></h4>
<p>Per la seva part, el client també pot examinar l’adreça IP oferta pel servidor per comprovar si està en ús o no. Pot fer altres proves per veure si li sembla correcta o no l’oferta rebuda del servidor. Per exemple, en el cas de renovació d’una IP el client pot rebre una IP diferent a la que utilitza i no li interessa. En aquests casos, el client pot enviar un paquet DHCP <em>decline</em> al servidor per indicar que la seva oferta ha estat rebutjada.</p>
<h4 id="dhcp-release">DHCP <em>release</em></h4>
<p>Quan un client ja no necessita més l’ús de la configuració IP que ha rebut, la pot alliberar enviant al servidor un paquet DHCP <em>release</em>. En fer-ho, el servidor afegeix l’adreça IP al conjunt d’adreces dinàmiques que té disponibles. També fa l’anotació pertinent en el <strong>registre de concessions</strong> (leases) per indicar que ha finalitzat l’ús de l’adreça. De totes maneres, molt sovint el client no pot arribar a emetre aquest paquet perquè és apagat per l’usuari sense deixar temps al sistema per alliberar la IP.</p>
<h4 id="dhcp-information">DHCP <em>information</em></h4>
<p>En tot moment el client pot sol·licitar més informació sobre la configuració de xarxa al servidor utilitzant un paquet DHCP <em>information</em>. En el paquet DHCP <em>offer</em> que el servidor envia al client, consten les informacions generals de configuració de xarxa que es trameten en l’oferta: adreça IP, màscara de xarxa, porta d’enllaç predeterminada, servidor DNS, fitxer a baixar i molts altres paràmetres que poden estar configurats per enviar-se en l’oferta. El client pot tornar a demanar al servidor la informació d’aquests paràmetres o pot sol·licitar informació per a la configuració d’altres paràmetres (WINS, NetBIOS, hostname, etc.). El client només pot realitzar una petició d’informació DHCP <em>information</em> al servidor un cop ja està configurat.</p>
<div class="admonition example">
<p class="admonition-title">Exemple de mala configuració d'un equip</p>
<p>Un exemple de mala configuració és la d’un equip que s’ha engegat amb una adreça IP estàtica errònia que se solapa amb les adreces IP que reparteix el servidor. El mecanisme usat per comprovar si l’adreça IP ja està essent utilitzada és fer un <strong>ping</strong>. Si ningú no respon és que està lliure (segurament).</p>
<p>Quan un servidor DHCP detecta que la IP que havia reservat per a un client i que li anava a concedir ja està en ús, el servidor envia al client un paquet <em>DHCPNACK</em> i indica la no-autorització de la concessió. El client que rep un <em>DHCPNACK</em> ha de tornar a iniciar tot el procés de negociació començant un altre cop pel DHCP discovery.</p>
<p>Com és possible que algun equip de la xarxa utilitze una adreça IP que forma part del conjunt d’adreces IP dinàmiques que reparteix el servidor DHCP? La resposta és senzilla: <strong>perquè hi ha algun equip mal configurat</strong>.</p>
</div>
<h3 id="peticio-de-renovacioconcessio-duna-ip-concreta">Petició de renovació/concessió d'una IP concreta</h3>
<p>El procés de quatre fases usuals de DHCP consistent en <em>discovery/offer/request/ack</em> es produeix quan el client sol·licita una IP de nou. Sabem que les concessions són per a un interval de temps passat, la renovació de la qual cal que el client la demani. Existeix, doncs, un procés de renovació simplificat. El client demana continuar usant la mateixa IP amb un paquet DHCP <em>request</em>, i el servidor li concedeix o no amb els paquets DHCP <em>ACK/NACK</em>.</p>
<p>Un altre cas és un client que demana usar (renovar) una adreça IP que el servidor no li pot concedir (està en ús, no és de l’interval que gestiona, etc.). En aquesta situació, el servidor envia un DHCP <em>NACK</em>.</p>
<div class="admonition note">
<p class="admonition-title">Tipus d'adreçament</p>
<p>Hi ha diversos tipus d'adreçament:</p>
<ul>
<li>Unidestinació o <em>unicast</em>: a un equip</li>
<li>Multidestinació o <em>multicast</em>: a un conjunt d'equips</li>
<li>De difusió o <em>broadcast</em>: a tothom</li>
</ul>
</div>
<details class="question">
<summary>ACTIVITAT 1: Diagrama UDP</summary>
<p>Elabora un diagrama DHCP incloent els noms dels missatges que s'intercanvien per a establir una nova configuració IP, els equips que participen, ports UDP i explicacions de cada missatge.</p>
<p>A més a més, afig una captura de la seqüència de missatges capturats amb wireshark (filtre: bootp).</p>
</details>
<h2 id="intervals-exclusions-concessions-i-reserves">Intervals, exclusions, concessions i reserves</h2>
<p>Els clients DHCP obtenen del servidor una configuració de xarxa. Descrivim ara alguns dels termes que tenen lloc durant aquest procés, i que formen part de la configuració DHCP.</p>
<p><strong>Interval</strong>: anomenen interval d’adreces IP el conjunt d’adreces dinàmiques que el servidor té disponibles per assignar als clients. Les adreces IP disponibles s’agrupen per oferir-se a les diverses subxarxes que atén el servidor. Una mateixa subxarxa pot disposar de diversos intervals. Segurament s’entendrà més fàcilment amb un exemple:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span>
<span class="normal"><a href="#__codelineno-0-5">5</a></span>
<span class="normal"><a href="#__codelineno-0-6">6</a></span>
<span class="normal"><a href="#__codelineno-0-7">7</a></span>
<span class="normal"><a href="#__codelineno-0-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a>subnet 140.220.191.0 netmask 255.255.255.0 {
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>    range 140.220.191.150 140.220.191.249;
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>}
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>subnet 239.252.197.0 netmask 255.255.255.0 {
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>   range 239.252.197.10 239.252.197.107;
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>   range 239.252.197.113 239.252.197.250;
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>}
</code></pre></div></td></tr></table></div>
<p>En l’exemple anterior s’observa que la primera subxarxa disposa d'un interval de 100 adreces dinàmiques (de la 140.220.191.150 al 250). La segona subxarxa permet assignar dinàmicament dos intervals d'adreces no correlatius.</p>
<p><strong>Exclusions</strong>: entenem per exclusions aquelles adreces IP que no s'ofereixen dinàmicament per part del servidor. És a dir, que no formen part de cap interval.</p>
<p><strong>Concessions</strong>: l’assignació d’una adreça IP i la resta de paràmetres de xarxa a un client per part del servidor, és una concessió (o <em>lease</em>). Els clients reben les concessions per períodes de temps <strong>finits</strong>, que en finalitzar, cal renegociar. Tant el client com el servidor s’anoten les concessions, el client la que rep i el servidor les que concedeix. Quan finalitza una concessió el servidor pot decidir revocar-la o ampliar-ne la concessió.</p>
<p>El client, en qualsevol moment, pot decidir renunciar a la concessió. Si el client vol allargar la concessió inicia un diàleg DHCP abreujat amb el servidor que pot acabar amb una renovació o amb la pèrdua de la concessió (sempre pot tornar a començar el procés). Tant el servidor com el client normalment miren les concessions que s’han efectuat entre ells amb anterioritat per tal de, si és possible, repetir la mateixa assignació.</p>
<p><strong>Reserves</strong>: anomenem reserves aquelles adreces IP que s’assignen via DHCP però <strong>de manera fixa</strong>. És a dir, són adreces que s’assignen dinàmicament però sempre i únicament a un host determinat. Fixeu-vos que tot i ser una adreça dinàmica només s’utilitza si el host associat en fa ús. Si el host està apagat l’adreça no es pot usar per a altres hosts, està reservada. Un exemple podria ser:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span>
<span class="normal"><a href="#__codelineno-1-3">3</a></span>
<span class="normal"><a href="#__codelineno-1-4">4</a></span>
<span class="normal"><a href="#__codelineno-1-5">5</a></span>
<span class="normal"><a href="#__codelineno-1-6">6</a></span>
<span class="normal"><a href="#__codelineno-1-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a>subnet 140.220.191.0 netmask 255.255.255.0 {
<a id="__codelineno-1-2" name="__codelineno-1-2"></a>   host iesserver {
<a id="__codelineno-1-3" name="__codelineno-1-3"></a>      hardware ethernet 08:00:2b:4c:59:23;
<a id="__codelineno-1-4" name="__codelineno-1-4"></a>      fixed-address 140.220.191.1;
<a id="__codelineno-1-5" name="__codelineno-1-5"></a>   }
<a id="__codelineno-1-6" name="__codelineno-1-6"></a>   range 140.220.191.150 140.220.191.249;
<a id="__codelineno-1-7" name="__codelineno-1-7"></a>}
</code></pre></div></td></tr></table></div>
<p>En aquest exemple es pot veure que l'adreça 140.220.191.1 és una adreça reservada exclusivament per al host <strong><em>iesserver</em></strong>, que s’identifica mitjançant la seva adreça MAC (<em>hardware ethernet</em>).</p>
<details class="question">
<summary>ACTIVITAT 2: Conceptes bàsics</summary>
<p>Defineix en un document els següents conceptes:</p>
<ul>
<li>Interval</li>
<li>Exclusions</li>
<li>Concessions</li>
<li>Reserves</li>
</ul>
<p>Crea un fitxer de configuració indicant exemples dels conceptes anteriors. La xarxa de treball serà la 192.168.10.0/24.</p>
</details>
<h2 id="opcions-addicionals-del-protocol">Opcions addicionals del protocol</h2>
<p>Recorda que el protocol DHCP proporciona la configuració IP no sols una adreça IP i la màscara. Per a afegir nous paràmetres s'utilitza la paraula reservada <strong><em>option</em></strong>.</p>
<h3 id="option-subnet-mask"><em>option subnet-mask</em></h3>
<p>L'opció <em>subnet-mask</em> s'utilitza per especificar la màscara de subxarxa que s'enviarà al client, si s'omet s'enviaria la màscara que va associada amb la declaració subnet a la qual pertanyi la IP assignada. El normal és ometre-la per facilitar el manteniment del fitxer de configuració. La seva sintaxi és la següent:</p>
<p><code>option subnet-mask ip-address;</code></p>
<div class="admonition example">
<p class="admonition-title">Exemple</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span>
<span class="normal"><a href="#__codelineno-2-4">4</a></span>
<span class="normal"><a href="#__codelineno-2-5">5</a></span>
<span class="normal"><a href="#__codelineno-2-6">6</a></span>
<span class="normal"><a href="#__codelineno-2-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a>subnet 10.0.0.0 netmask 255.255.255.0 {
<a id="__codelineno-2-2" name="__codelineno-2-2"></a>    range 10.0.0.10 10.0.0.254;
<a id="__codelineno-2-3" name="__codelineno-2-3"></a>    option domain-name-servers 8.8.8.8, 8.8.4.4;
<a id="__codelineno-2-4" name="__codelineno-2-4"></a>    option routers 10.0.0.1;
<a id="__codelineno-2-5" name="__codelineno-2-5"></a>    option broadcast-address 10.0.0.255;
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="hll">    option subnet-mask 255.255.255.0;
</span><a id="__codelineno-2-7" name="__codelineno-2-7"></a>}
</code></pre></div></td></tr></table></div>
</div>
<h3 id="option-routers"><em>option routers</em></h3>
<p>L'opció <em>routers</em> s'usa per enviar-li al client la seva porta d'enllaç. Pot especificar una IP numèrica o un nom. La seva sintaxi és la següent:</p>
<p><code>option routers ip-address;</code></p>
<div class="admonition example">
<p class="admonition-title">Exemple</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span>
<span class="normal"><a href="#__codelineno-3-4">4</a></span>
<span class="normal"><a href="#__codelineno-3-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a>subnet 10.0.0.0 netmask 255.255.255.0 {
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>    range 10.0.0.10 10.0.0.254;
<a id="__codelineno-3-3" name="__codelineno-3-3"></a>    option domain-name-servers 8.8.8.8, 8.8.4.4;
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="hll">    option routers 10.0.0.1;
</span><a id="__codelineno-3-5" name="__codelineno-3-5"></a>}
</code></pre></div></td></tr></table></div>
</div>
<h3 id="option-domain-name-servers"><em>option domain-name-servers</em></h3>
<p>L'opció <em>domain-name-servers</em> s'empra per enviar al client els servidors DNS que utilitzarà. La seva sintaxi és la següent:</p>
<p><code>option domain-name-servers ip-address [, ip-address ...]</code></p>
<p>Els servidors s'han d'especificar <strong>per ordre de preferència</strong>, sent el primer de la llista el que s'utilitzarà com a servidor DNS primari.</p>
<p>Els  servidors DNS també es poden especificar, si volem, a través de noms que el servidor DHCP resoldrà amb l'ajuda del servidor de noms especificat en la configuració de la xarxa de l'equip on es trobe. L'avantatge d'usar noms en comptes d'IP, és que si aquestes canvien, el nom normalment no canviarà i per tant no caldrà modificar la configuració del servidor DHCP, però l'inconvenient és que la resposta al client, que sempre serà una IP, tardarà una mica més.</p>
<p>En el cas d'usar noms en comptes de IP és aconsellable instal·lar al costat del servidor DHCP un servidor DNS, o si més no que el servidor DNS estiga en el mateix segment de xarxa que el servidor DHCP, això agilitzarà bastant la resposta als clients.</p>
<div class="admonition example">
<p class="admonition-title">Exemples</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a>option domain-name-servers ns.elmeudns.com;
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a>option domain-name-servers 8.8.8.8, 8.8.4.4;
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span>
<span class="normal"><a href="#__codelineno-6-2">2</a></span>
<span class="normal"><a href="#__codelineno-6-3">3</a></span>
<span class="normal"><a href="#__codelineno-6-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a>subnet 10.0.0.0 netmask 255.255.255.0 {
<a id="__codelineno-6-2" name="__codelineno-6-2"></a>    range 10.0.0.10 10.0.0.254;
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="hll">    option domain-name-servers 8.8.8.8, 8.8.4.4
</span><a id="__codelineno-6-4" name="__codelineno-6-4"></a>}
</code></pre></div></td></tr></table></div>
</div>
<h2 id="problemes-del-servei">Problemes del servei</h2>
<h3 id="atacs-al-funcionament-de-dhcp-i-conflictes-dadreces-ip">Atacs al funcionament de DHCP i conflictes d'adreces IP</h3>
<p>Com tot servei de xarxa, el servidor DHCP és susceptible de patir atacs mal intencionats. L’atac més fàcil i clàssic és el <em>DoS</em> o de denegació de servei. Consisteix a inundar de peticions un servidor per tal de saturar-lo i bloquejar-ne el funcionament. Un client pot realitzar innumerables peticions DHCP <em>discovery</em> fingint que són clients diferents (emmascarant la seva MAC) amb la intenció d’esgotar les adreces IP disponibles del servidor o simplement amb la intenció de sobrecarregar-lo amb tantes peticions que no done a l’abast a atendre-les o que ho faci lentament.</p>
<p>Un altre tipus d’atac consisteix a falsejar la informació que s’envia al client (DHCP <em>Spoofing</em>). Recordem que el client fa una sol·licitud d’IP en forma de difusió (<em>broadcast</em>) i la seva petició pot ser atesa per un o més servidors DHCP. Un dels servidors DHCP pot ser un atacant que intentarà proporcionar informació de configuració falsa al client. Per exemple indicant un servidor DNS també maliciós. Aquest pot falsejar les identitats de les màquines de la xarxa i, quan el client s’adreça a la seva entitat bancària, el servidor DNS en realitat li ha proporcionat una IP d’una màquina que falseja la de l’entitat bancària. Perillós, veritat?</p>
<p>Per posar remei a la inseguretat en la comunicació client-servidor DHCP, el protocol permet utilitzar mecanismes d’autenticació i xifratge. Aquests mecanismes queden fora de l’abast d’aquesta explicació.</p>
<p><center><img alt="DHCP Spoofing" src="../img/ud3/atacDHCP.png" /></center></p>
<h3 id="conflictes-amb-les-adreces-ip">Conflictes amb les adreces IP</h3>
<p>Un dels principals motius per utilitzar DHCP és simplificar el procés de configuració de xarxa i minimitzar els conflictes per encavalcament d’adreces IP. Per desgràcia, això no garanteix que no es puguin produir conflictes. Per exemple, ens podem trobar en situacions en què dues màquines diferents tinguin la mateixa IP per una simple mala configuració del servidor DHCP. Un altre cas típic és el d’un client que s’ha configurat ell mateix una IP estàtica quan en la xarxa ja hi havia un equip que utilitzava la mateixa adreça IP assignada pel servidor DHCP.</p>
<p>Un problema habitual per als administradors poc experimentats és definir una configuració de xarxa local al client (<em>hostname</em>, servidor DNS, porta d’enllaç a utilitzar, etc.), però demanar l’adreça IP dinàmicament. La configuració dinàmica no és solament la IP i la màscara, sinó que el servidor DHCP pot proporcionar altres paràmetres de xarxa que sobreescriuran els que el client tenia definits localment (aquest és l’objectiu de DHCP!).</p>
<p>La configuració rebuda per DHCP sobreescriu la configuració local del client.</p>
<h3 id="diversos-servidors-dhcp-en-la-mateixa-xarxa">Diversos servidors DHCP en la mateixa xarxa</h3>
<p>Un altre dels problemes habituals és que per error o maldat es connecte a la xarxa un altre servidor DHCP que responga primer a les peticions de DHCP <em>Discover</em>. En els entorns corporatius cal tindre control de què es connecta a la xarxa per a evitar problemes. Aquests tipus d'escenaris es poden minimitzar indicant que el servidor és autoritari en el segment de xarxa afectat.</p>
<hr />
<details class="danger">
<summary>PRÀCTICA 1: Instal·lació i configuració d'un servei DHCP</summary>
<p><strong>OBJECTIUS</strong></p>
<ul>
<li>Instal·lar un servei de configuració dinàmica dels paràmetres de xarxa.</li>
<li>Presentar el servei per assignar la configuració bàsica als sistemes d'una xarxa local.</li>
<li>Realitzar assignacions dinàmiques i estàtiques.</li>
</ul>
<p><strong>RECURSOS NECESSARIS</strong></p>
<ul>
<li>Un ordinador amb connexió a Internet o una maquina virtual amb Ubuntu Server.</li>
<li>El programari ISC DHCP.</li>
<li>La guía d'instal·lació:<ul>
<li><a href="https://documentation.ubuntu.com/server/how-to/networking/install-isc-dhcp-server/">How to install and configure iscp-dhcp-server</a></li>
<li><a href="https://help.ubuntu.com/community/dhcp3-server">DHCP3-server</a></li>
</ul>
</li>
</ul>
<p><strong>ENUNCIAT</strong></p>
<p>Per a la xarxa interna de l'entorn de treball instal·la el servei DHCP i configura'l de forma que:</p>
<ul>
<li>Assigne dinàmicament les 100 primeres adreces disponibles.</li>
<li>Assigne la configuració addicional necessària perquè els clients DHCP puguen connectar-se a Internet.</li>
<li>Reserve la adreça IP 101 per a l'equip amb Windows.</li>
</ul>
<p><strong>ENTREGABLE</strong></p>
<p>Guia d'instal·lació i configuració del servei DHCP en Ubuntu incloent:</p>
<ul>
<li>Arxius de configuració bàsics.<ul>
<li>Limitació perquè el DCHP sols funcione en la xarxa interna.</li>
<li>Canvis realitzats explicant els efectes.</li>
</ul>
</li>
<li>Arxiu de concessions (leases)</li>
<li>Registre del sistema on es demostre una concessió.</li>
<li>Captura del comandament: <code>sudo dhcpd -t -cf /etc/dhcp/dhcpd.conf</code></li>
<li>En Windows:<ul>
<li>Execució de ipconfig /release</li>
<li>Execució de ipconfig /renew</li>
<li>Comprovació de la configuració assignada al Windows XP.</li>
<li>Captura amb <em>wireshark</em> del trànsit DHCP on es comprove tot el procés.</li>
</ul>
</li>
</ul>
</details>







  
  



  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Torna a l'inici
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Peu de pàgina" >
        
          
          <a href="../SMX2-SXA-2/" class="md-footer__link md-footer__link--prev" aria-label="Anterior: UD2. Accés remot">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Anterior
              </span>
              <div class="md-ellipsis">
                UD2. Accés remot
              </div>
            </div>
          </a>
        
        
          
          <a href="../SMX2-SXA-4/" class="md-footer__link md-footer__link--next" aria-label="Següent: UD4. El servei DNS">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Següent
              </span>
              <div class="md-ellipsis">
                UD4. El servei DNS
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Apunts SXA - 2SMX by P.Galera & J.Beteta es troba sota llicència CC BY-NC-SA 4.0 - <a href="#__consent">Canvia la configuració de les cookies</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="mailto:fj.galerataberner@edu.gva.es" target="_blank" rel="noopener" title="Contacte" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480v-83.6c0-4 1.5-7.8 4.2-10.8l167.6-182.8c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8l-88.3-44.2C7.1 311.3.3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  




  


<h4>Consentiment de Cookies</h4>
<p>Utilitzem cookies per reconèixer les vostres visites i preferències repetides, així com per mesurar l'eficàcia de la nostra documentació i si els usuaris troben el que estan cercant. Amb el vostre consentiment, ens esteu ajudant a millorar la nostra documentació.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accepta</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Gestiona la configuració</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.top", "navigation.footer", "toc.follow", "content.code.copy"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copiat al porta-retalls", "clipboard.copy": "C\u00f2pia al porta-retalls", "search.result.more.one": "1 m\u00e9s en aquesta p\u00e0gina", "search.result.more.other": "# m\u00e9s en aquesta p\u00e0gina", "search.result.none": "Cap document coincideix", "search.result.one": "1 document coincident", "search.result.other": "# documents coincidents", "search.result.placeholder": "Escriu per a comen\u00e7ar a cercar", "search.result.term.missing": "Desaparegut", "select.version": "Selecciona la versi\u00f3"}}</script>
    
    
      <script src="../assets/javascripts/bundle.af256bd8.min.js"></script>
      
    
  </body>
</html>